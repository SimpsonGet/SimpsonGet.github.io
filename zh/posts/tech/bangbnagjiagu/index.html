<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ | Simpson&#39;s Blog</title>
<meta name="keywords" content="æ¢†æ¢†åŠ å›º, æ£€æµ‹">
<meta name="description" content="æ¯”è¾ƒæ°´æ°´ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯æ›´ç€å…¶ä»–äººçš„åšå®¢åˆ†æäº†ä¸€è¾¹å…¶æ£€æµ‹ï¼Œå…³äºè§£å¯†å’ŒåŠ è½½dexçš„éƒ¨åˆ†æ²¡çœ‹">
<meta name="author" content="simpson">
<link rel="canonical" href="https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/">

 <link crossorigin="anonymous" href="/assets/css/stylesheet.36819bea596090d8b48cf10d9831382996197aa7e4fc86f792f7c08c9ca4d23b.css" integrity="" rel="preload stylesheet" as="style">
<link rel="icon" href="https://SimpsonGet.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://SimpsonGet.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://SimpsonGet.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://SimpsonGet.github.io/logo.gif">
<link rel="mask-icon" href="https://SimpsonGet.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/">
  <meta property="og:site_name" content="Simpson&#39;s Blog">
  <meta property="og:title" content="æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ">
  <meta property="og:description" content="æ¯”è¾ƒæ°´æ°´ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯æ›´ç€å…¶ä»–äººçš„åšå®¢åˆ†æäº†ä¸€è¾¹å…¶æ£€æµ‹ï¼Œå…³äºè§£å¯†å’ŒåŠ è½½dexçš„éƒ¨åˆ†æ²¡çœ‹">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-08T10:52:17+08:00">
    <meta property="article:modified_time" content="2025-07-08T10:52:17+08:00">
    <meta property="article:tag" content="Android">
    <meta property="article:tag" content="Shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ">
<meta name="twitter:description" content="æ¯”è¾ƒæ°´æ°´ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯æ›´ç€å…¶ä»–äººçš„åšå®¢åˆ†æäº†ä¸€è¾¹å…¶æ£€æµ‹ï¼Œå…³äºè§£å¯†å’ŒåŠ è½½dexçš„éƒ¨åˆ†æ²¡çœ‹">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://SimpsonGet.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Tech",
      "item": "https://SimpsonGet.github.io/zh/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ",
      "item": "https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ",
  "name": "æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ",
  "description": "æ¯”è¾ƒæ°´æ°´ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯æ›´ç€å…¶ä»–äººçš„åšå®¢åˆ†æäº†ä¸€è¾¹å…¶æ£€æµ‹ï¼Œå…³äºè§£å¯†å’ŒåŠ è½½dexçš„éƒ¨åˆ†æ²¡çœ‹",
  "keywords": [
    "æ¢†æ¢†åŠ å›º", "æ£€æµ‹"
  ],
  "articleBody": "\ræ ·æœ¬ï¼šè¶…æ˜Ÿå­¦ä¹ é€š[v6.5.9]\nåŒ…åï¼šcom.chaoxing.mobile\njavaå±‚åˆ†æ æ¢†æ¢†åŠ å›ºç‰¹å¾\nç¨‹åºå…¥å£ç‚¹\næ ¹æ®ç³»ç»Ÿæ¶æ„é€‰æ‹©\nåœ¨load()å‡½æ•°åï¼Œä½¿ç”¨doAttach()åˆ©ç”¨åå°„çš„æ‰‹æ®µè°ƒç”¨ä»£ç ï¼Œé‚£ä¹ˆlibDexHelper.soå³ä¸ºå¯¹åŸå§‹dexæ–‡ä»¶çš„é‡Šæ”¾\nnativeå±‚åˆ†æ soæ–‡ä»¶ï¼šlibDexHelper.so\nç›´æ¥æ‰“å¼€apkä¸­çš„soæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°soæ–‡ä»¶è¢«åŠ å¯†\nè·å–è§£å¯†åçš„soæ–‡ä»¶ dumpè§£å¯†soæ–‡ä»¶çš„æ—¶æœº\nåšæ–‡ç»™å‡ºçš„æ˜¯åœ¨android_dlopen_extæ—¶æœº\ndumpçš„é€»è¾‘æ˜¯ä¿®æ”¹ç›®æ ‡æ®µçš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œå†å°†å†…å­˜è¯»åˆ°ç¼“å†²åŒºï¼Œå†™å…¥ç›®æ ‡åœ°å€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 function hook_dlopen(){ var soName = \"libDexHelper.so\" Interceptor.attach(Module.findExportByName(null, 'android_dlopen_ext'),{ onEnter : function(args){ //arg[0] æ˜¯è¦åŠ è½½çš„soçš„è·¯å¾„ if(args[0] != null){ let loadPath = Memory.readUtf8String(args[0]) console.log(\"dlopen call is: \" + loadPath + \"\\n\") if (loadPath.includes(soName)){ this.flag = 1 } } },onLeave:function(retval){ console.log(\"dlopen return\\n\") if (this.flag === 1){ dumpSo(soName) this.flag = 0 } } }) } function dumpSo(filename){ var handle = Process.getModuleByName(filename) console.log(\"[dump] start dumping ---------\" + handle) var path = \"/data/data/com.chaoxing.mobile/\" + handle.name + \"_\" + handle.base + \"_\" + ptr(handle.size) + \".so\" var file_handle = new File(path, \"wb\") if(!file_handle){ console.log(\"[dump] dump failed\") return } Memory.protect(ptr(handle.base), handle.size, 'rwx') var libbuffer = ptr(handle.base).readByteArray(handle.size) file_handle.webkitRelativePath(libbuffer) file_handle.close() console.log(\"[dump] dump finished and path is: \" + path) } setImmediate(hook_dlopen) å†…å­˜ä¸­dumpä¸‹æ¥çš„soæ–‡ä»¶éœ€è¦è¿›è¡Œä¿®å¤ï¼Œè¿™é‡Œä½¿ç”¨sofixerä¿®å¤\n1 2 3 4 5 sofixer -s soruce.so -o fix.so -m 0x0 -d -s å¾…ä¿®å¤çš„soè·¯å¾„ -o ä¿®å¤åçš„soè·¯å¾„ -m å…§å­˜dumpçš„åŸºåœ°å€(16ä½) 0xABC -d è¾“å‡ºdebugä¿¡æ¯ ä¿®å¤å\nè¿˜æœ‰ä¸€äº›å‡½æ•°åè¢«æ··æ·†ï¼Œç”¨idapythonæ¢å¤ä¸ºsub_offset\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import idautils import idc def rename_function(): for func_ea in idautils.Functions(): funcName = idc.get_func_name(func_ea) if funcName.startswith(\"pS\") or funcName.startswith(\"j_\") or funcName.startswith(\"p5\"): editName = f\"sub_{func_ea:X}\" else: continue if idc.set_name(func_ea, editName, idc.SN_NOWARN): print(f\"[Success] {funcName} ---\u003e {editName} in (0x{func_ea:X})\") rename_function() åˆ†æ JNI_Onloadä¸­\n1 2 3 4 5 6 7 8 9 com/secneo/apkwrapper/H (Ljava/lang/String;)I (Ljava/lang/String;I)V (I)V (Ljava/lang/String;)Ljava/lang/String; d com/secneo/apkwrapper/AW ()V pn (Landroid/content/Context;Landroid/app/Application;)V hn sub_3199Cå‡½æ•°é›†åˆäº†å„ç§æ£€æµ‹\næœ‰å¾ˆå¤šè·³æ¿å‡½æ•°ï¼Œéœ€è¦ç»“åˆ0x71aeb83000å†…å­˜åŠ è½½åœ°å€å»è·³è½¬\n0x430C0å®ç°å¯¹ libc.so ä¸­ readã€open64ã€openat64ç­‰\tå‡½æ•°çš„ hook æˆ–æ›¿æ¢ã€‚\nsub_52BC4ä¸­\nlibcç¬¦å·è¡¨æ¢å¤ ä¸€äº›thunkå‡½æ•°0x7254D05110å…¶å®æ˜¯libcä¸­çš„\nbase = 0x7254c9a000\nå¯¼å‡ºlibcç¬¦å·è¡¨ 1 nm -D libc.so \u003e libc_symbols.txt å¯¼å…¥åˆ°libdexhelpä¸­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import idautils import ida_bytes import idc libc_base = 0x7254c9a000 # /proc/pid/maps/ è·å¾— libc_symbols = {} with open('./libc_symbols.txt', 'r') as f: for line in f: parts = line.strip().split() if len(parts) \u003e= 3: offset = int(parts[0], 16) name = parts[2].split('@@')[0] # å»æ‰ç‰ˆæœ¬å· libc_symbols[libc_base + offset] = name # éå†å½“å‰æ®µä¸­çš„ qword for ea in idautils.Segments(): segname = idc.get_segm_name(ea) if '.data' in segname or '.got' in segname: start = idc.get_segm_start(ea) end = idc.get_segm_end(ea) for addr in range(start, end, 8): # 64ä½ç³»ç»Ÿ if idc.is_qword(ida_bytes.get_full_flags(addr)): ptr_val = idc.get_qword(addr) if ptr_val in libc_symbols: name = f\"{libc_symbols[ptr_val]}_ptr\" idc.set_name(addr, name, idc.SN_CHECK) print(f\"[success] edit the {addr} ---\u003e {name}\") ã€sub_52BC4ã€‘æ£€æµ‹frida 1 2 3 4 5 6 7 //libcéƒ¨åˆ†å‡½æ•°çš„å‚æ•°åŠç”¨æ³• sendtoï¼ˆint sockfdï¼Œ const void *msgï¼Œint len , unsigned int flagsï¼Œ const struct sockaddr *toï¼Œ int tolenï¼‰ // recvfromï¼ˆint sockfdï¼Œvoid *bufï¼Œint lenï¼Œunsigned int lagsï¼Œstruct sockaddr *fromï¼Œint *fromlen // access(const char* pathname, int mode) //æ£€æŸ¥è°ƒç”¨è¿›ç¨‹æ˜¯å¦èƒ½å¯¹pathnameæŒ‡å®šçš„æ–‡ä»¶ä½œmodeæ“ä½œï¼ŒæˆåŠŸæ‰§è¡Œè¿”å›0ï¼Œå¤±è´¥ä¸º-1 1 2 3 4 5 6 7 8 qword_EDE40 = GET/ws HTTP/1.1 Upgrade: websocket Connection: Upgrade Sec-WebSocket-Key: nmmA32Q10Aqj2vWK w== Sec-WebSocket-Version: 13 Host: 127.0.0.1:27042 1 2 3 4 5 v16[0] = 2; //è¿™ä¸ªèµ‹å€¼æ“ä½œçœ‹èµ·æ¥åƒæ˜¯è®¾ç½®æŸä¸ªåè®®æ—ï¼ˆfamilyï¼‰ã€‚ åœ¨å¸¸è§çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒAF_INET çš„å€¼æ˜¯ 2ï¼Œè¡¨ç¤º IPv4 åœ°å€æ—ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ª sockaddr_in ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µ sin_familyã€‚ v4 = 20000; è¿™ä¸ªå˜é‡ v4 è¢«è®¾ç½®ä¸º 20000ã€‚è€ƒè™‘åˆ°åç»­çš„æ“ä½œï¼Œè¿™ä¸ªå€¼å¾ˆå¯èƒ½æ˜¯ç”¨äºè®¾ç½®ç«¯å£å·ã€‚ v16[1] = bswap32(v4) \u003e\u003e 16; è¿™é‡Œå¯¹ v4 è¿›è¡Œäº†å­—èŠ‚äº¤æ¢ (bswap32) å¹¶å³ç§» 16 ä½ã€‚å­—èŠ‚äº¤æ¢é€šå¸¸ç”¨äºå¤„ç†ä¸åŒå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œä»ä¸»æœºå­—èŠ‚åºåˆ°ç½‘ç»œå­—èŠ‚åºï¼‰ã€‚å‡è®¾ bswap32(v4) å°† v4 çš„å­—èŠ‚é¡ºåºåè½¬ï¼Œå¯¹äºå€¼ 20000ï¼ˆå³åå…­è¿›åˆ¶çš„ 0x4E20ï¼‰ï¼Œå…¶å­—èŠ‚äº¤æ¢åçš„ç»“æœä»ç„¶æ˜¯ 0x4E20ï¼ˆå› ä¸ºå®ƒæ˜¯32ä½æ•´æ•°ï¼Œä¸”é«˜ä½å­—èŠ‚ä¸ºé›¶ï¼‰ã€‚ç„¶åå°†å…¶å³ç§»16ä½ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ 0x0000ã€‚ æ ¹æ®27042ç«¯å£ï¼Œå³ æœ¬åœ°çš„ Frida Server é»˜è®¤ç›‘å¬ç«¯å£\n1 2 3 4 è¿™æ®µä»£ç çš„è¡Œä¸º ç”¨ AUTH\\r\\n æ¢æµ‹æœåŠ¡æ˜¯å¦å¼€å¯ å‘é€æ ‡å‡† WebSocket è¯·æ±‚åˆ° 127.0.0.1:27042ï¼Œåˆ†ææ˜¯å¦è¿”å› Sec-WebSocket-Acceptï¼Œåˆ¤æ–­ WebSocket æ˜¯å¦è¢«æ¥å— å¦‚æœæˆåŠŸï¼Œè¯´æ˜æœ¬åœ° Frida æ­£åœ¨è¿è¡Œï¼Œè¢«è¯†åˆ« ã€sub_4CB6Cã€‘ç¯å¢ƒæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 xmmword_C4200 = [-2, -3, -1, -2, -3, -1, -2, -3, -1, -2, -3, -1, -2, -3, -1, -2] def v37_a(old, num): print(chr(ord(old) -num)) def common(oldstr): tmp = \"\" tmp2 = \"\" tmp += oldstr[0] if (len(oldstr) \u003e 16): tmp2 = oldstr[17::] for i in range(16): tmp += chr(ord(oldstr[i + 1]) + xmmword_C4200[i]) if (len(oldstr) \u003e 16): tmp += tmp2 return tmp def v37_1(): v37 = \"0uejp2/ersg2ed011pbiltm1ed\" a0uejp2Ersg2ed0 = \"0uejp2/ersg2ed011pbiltm1ed\" # a(a0uejp2Ersg2ed0[17], 3) # a(a0uejp2Ersg2ed0[18] ,1) # a(a0uejp2Ersg2ed0[19] , 2) # a(a0uejp2Ersg2ed0[20] , 3) # a(a0uejp2Ersg2ed0[21] , 1) # a(a0uejp2Ersg2ed0[22] , 2) # a(a0uejp2Ersg2ed0[23] , 3) # a(a0uejp2Ersg2ed0[24] , 1) # a(a0uejp2Ersg2ed0[25] , 2) v37 = \"/uejp2/ersg2ed011magisk.db\" v37 = common(v37) return v37 def v45_1(): v45 = \"0uejp2/ersg2nkusqr\" v45 = \"/uejp2/ersg2nkusqr\" v45 = common(v45) return v45 def v50_1(): v50 = \"0u|tvhn1ejp2ncjjuk\" v50 = \"/u|tvhn1ejp2ncjjuk\" v50 = common(v50) return v50 print(\"v37 === \",v37_1()) print(\"v45 === \",v45_1()) print(\"v50 === \",v50_1()) 1 2 3 4 5 6 /sbin/.core/db-0/magisk.db .coreæ˜¯ä½¿ç”¨çš„éšè—ç›®å½•ï¼ŒåŒ…å«å…¶æ ¸å¿ƒè¿è¡Œæ—¶æ•°æ®ã€‚æ•°æ®åº“å­˜å‚¨è®¾ç½®å’Œrootæƒé™ /sbin/.core/mirror\tæ˜¯ Magisk çš„ä¸€ä¸ªå…³é”®åŠŸèƒ½ â€”â€” system-as-root é•œåƒæŒ‚è½½ç‚¹\t/system/bin/magisk\tæ˜¯ä¸»ç¨‹åº /system/usr/we-need-root/ /system/bin/failsafe/ é€šè¿‡ä¸€äº›å­—ç¬¦ä¸²çš„æ‹¼æ¥è§£å¯†è·å¾—æ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨accesså‡½æ•°åˆ¤æ–­\n1ã€/sbin/.core/mirror\n2ã€/data/local/su\n3ã€/data/local/bin/su\n4ã€ /data/local/xbin/su\n5ã€/sbin/su\n6ã€/su/bin/su\n7ã€/system/bin/su\n8ã€/system/bin/.ext/su\n9ã€/system/bin/failsafe/su\n10ã€/system/sd/xbin/su\n11ã€/system/usr/we-need-root/su\n12ã€/system/xbin/su\nè°ƒç”¨ openat ä¸­æ–­è®¿é—®/proc/self/attr/prevæ–‡ä»¶è·å–æ•°å€¼ä¸å­—ç¬¦ä¸²u:r:zygote:s0æ¯”å¯¹è°ƒç”¨\nSELinux ä¸Šä¸‹æ–‡ï¼ˆSELinux Contextï¼‰æ£€æµ‹ï¼Œç”¨äºåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦è¿è¡Œåœ¨é¢„æœŸçš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­\n1 2 3 4 5 6 7 8 user:role:type:sensitivity u:r:zygote:s0 â†’ zygote è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡ /proc/self/attr/prev æ˜¯ä»€ä¹ˆï¼Ÿ è¿™æ˜¯ SELinux æä¾›çš„ä¸€ä¸ªæ¥å£æ–‡ä»¶ï¼Œè¡¨ç¤º å½“å‰è¿›ç¨‹çš„ä¸Šä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒApp æ˜¯ç”± Zygote å¯åŠ¨çš„ï¼Œå®ƒçš„ prev ä¸Šä¸‹æ–‡æ˜¯ u:r:zygote:s0 å¦‚æœä¿®æ”¹äº†å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡ su ææƒåå†å¯åŠ¨è¿™ä¸ª Appï¼Œé‚£ä¹ˆ prev ä¸Šä¸‹æ–‡å°±ä¼šå˜æˆ u:r:su:s0 æˆ–å…¶ä»–é zygote ä¸Šä¸‹æ–‡ ro.build.tags ä¸»è¦ç”¨äºæ ‡è¯†æ„å»ºç±»å‹å¦‚æœæ£€æµ‹åˆ° test-keys è€Œä¸æ˜¯ release-keysï¼Œåˆ™å¯èƒ½æç¤ºç”¨æˆ·å½“å‰ç³»ç»Ÿå­˜åœ¨æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚\nã€sub_52EA0ã€‘javaå±‚æ£€æµ‹ 1 2 3 4 5 int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg); //\\3) void *(*start_routine) (void *)ï¼šä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æŒ‡æ˜æ–°å»ºçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°æœ€å¤šæœ‰ 1 ä¸ªï¼ˆå¯ä»¥çœç•¥ä¸å†™ï¼‰ï¼Œå½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹éƒ½å¿…é¡»ä¸º void* ç±»å‹ã€‚void* ç±»å‹åˆç§°ç©ºæŒ‡é’ˆç±»å‹ï¼Œè¡¨æ˜æŒ‡é’ˆæ‰€æŒ‡æ•°æ®çš„ç±»å‹æ˜¯æœªçŸ¥çš„ã€‚ä½¿ç”¨æ­¤ç±»å‹æŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å…ˆå¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç„¶åæ‰èƒ½æ­£å¸¸è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ã€‚ æ ¹æ®pthread_createå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•å¾—x2å¯„å­˜å™¨å­˜æ”¾çš„sub_52EA0å‡½æ•°ï¼Œå…¶å®æ˜¯å°†è¦å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°åœ°å€\nçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œsub_52EA0\nè¿™è¾¹éœ€è¦æ ¹æ®æ±‡ç¼–æ‰‹åŠ¨æ¢å¤è¯¥å‡½æ•°çš„ç­¾åï¼ˆå› ä¸ºæ˜¯thunkè·³æ¿å‡½æ•°æ‰€ä»¥idaæ²¡æœ‰è‡ªåŠ¨è¯†åˆ«ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨idapythonå»åšè‡ªåŠ¨åŒ–æ‰¹é‡è®¾ç½®\n1 j_execl_ptr(\"/system/bin/app_process\", \"/system/bin/app_process\", \"/system/bin\", â€œ--nice-name=zygisk.soâ€, \"com.secneo.apkwrapper.H\", \"--write-fd\", v12, \"--flags\", 0, 0LL); soå±‚é€šè¿‡excelå¯¹javaå±‚è¿›è¡Œæ£€æµ‹ï¼Œæ£€æµ‹tracepid\nâ€‹\tã€sub_4D638ã€‘hookæ¡†æ¶æ£€æµ‹ å¤ªå¤šäº†å°±æ¢å¤ä¸¤ä¸ªçœ‹çœ‹\nisExportFunctionExistæ˜¯å¯¹ç›®æ ‡soä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼\né€šè¿‡mmapè¿›è¡Œæ˜ å°„åˆ°mapsä¸­ï¼Œä¸åŸæ¥å·²ç»åœ¨mapsçš„soåœ¨å†…å­˜ä¸­çš„å¯¼å‡ºå‡½æ•°è¿›è¡Œæ¯”å¯¹å‰16ä¸ªå­—èŠ‚ï¼Œ\nå¦‚æœæ¯”å¯¹ä¸ä¸€è‡´åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œå¦‚æœmapsæ²¡æœ‰è¿™ä¸ªsoåˆ™è¿”å›0ï¼Œå¦‚æœmapsä¸­æœ‰è¿™ä¸ªsoä½†æ²¡æœ‰è¿™ä¸ªè¦æœç´¢çš„å¯¼å‡ºå‡½æ•°åˆ™è¿”å›-1ã€‚\né€šè¿‡å¯¹æ¯”libart.soä¸­å¯¼å‡ºå‡½æ•°çš„å‰16å­—èŠ‚åˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹ã€‚\næ£€æŸ¥ç¯å¢ƒå˜é‡ CLASSPATH æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦éç©ºã€ä¸”æ˜¯å¦é•¿åº¦å¤§äºç­‰äº 6ã€‚ä¸ºäº†åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯å¦è¢«æ³¨å…¥ã€æ˜¯å¦æ­£ç¡®è®¾ç½®ã€æ˜¯å¦ä¼ªè£…æˆåŠŸç­‰ã€‚\nã€sub_4E308ã€‘è™šæ‹Ÿæœºæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 åœ¨Androidå¼€å‘ä¸­ï¼Œå¯ä»¥é€šè¿‡cæ¥å£ç›´æ¥è·å–è®¾å¤‡å±æ€§ï¼Œç³»ç»Ÿæ¥å£ä¸ºï¼š int __system_property_get(const char* name, char* value)ï¼› j___system_property_get_ptr(\"ro.bluetooth.name\", a1) j___system_property_get_ptr(\"vmos.browser.home\", a1) j___system_property_get_ptr(\"vmprop.wifissid\", a1) j___system_property_get_ptr(\"ro.product.manufacturer\", a1) j___system_property_get_ptr(\"ro.product.model\", a1) j___system_property_get_ptr(\"ro.product.manufacturer\", a1) ueventd.ttVM_x86.rcã€init.ttVM_x86.rcè¿™äº›æ˜¯ BlueStacks è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ä¼šåœ¨çœŸå®è®¾å¤‡ä¸­å‡ºç°ã€‚\nåˆ¤æ–­è¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ï¼Œ\tå…³é”®å­—åˆ¤æ–­ç­‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 #å…¶ä»–åšå®¢çš„æ€»ç»“ è°ƒç”¨ _system_property_get(\"ro.bluetooth.name\", resultAddr) ro.ip.name ro.product.manufacturer ro.product.model è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸\"vmos\"ï¼ˆ\"vmos\"ä»£è¡¨è™šæ‹Ÿæœºï¼‰æ¯”è¾ƒ è°ƒç”¨ _system_property_get(\"vmos.browser.home\", resultAddr) vmos.camera.enable ro.vmos.simplest.rom persist.vmos.setting.show persist.vmos.tool.show è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸0x30ä½œæ¯”è¾ƒï¼ˆæ»¡è¶³ä¸€å®šçš„æ¡ä»¶resultAddrä¼šè¢«è‡ªåŠ¨èµ‹å€¼ä¸º0x30ï¼‰æ¯”è¾ƒï¼Œæ­¤å¤„æ˜¯æ¯”è¾ƒä¸ç›¸åŒ è°ƒç”¨ _system_property_get(\"vmprop.wifissid\", resultAddr) è°ƒç”¨ _system_property_get(\"persist.vmos.root.enable\", resultAddr) è°ƒç”¨ _system_property_get(\"persist.vmos.root.show\", resultAddr) persist.vmos.skills.show persist.vmos.xposed.enable persist.vmos.xposed.show ro.vmos.simplest.rom vmos.camera.enable ä¸Šè¿°è°ƒç”¨_system_property_getè·å–å±æ€§å€¼ä¹‹åï¼Œå¦‚æœ_system_property_getçš„è¿”å›å€¼æ˜¯å¦å¤§äº0 è°ƒç”¨ access è®¿é—® /system/priv-app/vmos-pro-intent æ˜¯å¦å­˜åœ¨ fopen æ‰“å¼€ //proc/version.osed.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\"titan\" fopen æ‰“å¼€ //property_contexts.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\"titan\" fopen æ‰“å¼€ //service_contexts æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\"titan\" ã€sub_56C10ã€‘è°ƒè¯•å™¨æ£€æµ‹ é€šè¿‡foepn æ‰“å¼€/proc/pid/statusæ–‡ä»¶\nè°ƒç”¨sleep(1)å¾ªç¯æ£€æŸ¥statusæ–‡ä»¶æ£€æµ‹â€œstateâ€æ ‡å¿—å’Œ\"TracerPid:â€œæ ‡å¿—\nå¦‚æœè·å–çš„pidä¸ä¸º0ä¸”è·Ÿè°ƒç”¨getpidå‡½æ•°è·å–è‡ªèº«pidçš„ä¸ä¸€è‡´åˆ™è°ƒç”¨ä¸­æ–­ kill å…³é—­è°ƒè¯•è¿›ç¨‹\nã€è§£å¯†DEXã€‘ åŠ å¯†æ•°æ®å­˜æ”¾äºæœ€å¤§çš„dexä¸­ï¼Œæ ¹æ®dexdata0å®šä½\næ¯æ¬¡ç”³è¯·0x20000å¤§å°å¾ªç¯è§£å¯†\nsub_38E04\nä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šè¢«åŠ å¯†æ•°æ®çš„åœ°å€ã€å­˜æ”¾è§£å¯†åæ•°æ®çš„ä½ç½®ã€å‚ä¸è§£å¯†è¿ç®—çš„32å­—èŠ‚å¯†é’¥\n1 2 makeInMemoryDexElements çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š å°†å†…å­˜ä¸­çš„ DEX æ–‡ä»¶ï¼ˆæˆ– ZIP/APK ä¸­çš„ DEXï¼‰è½¬æ¢ä¸º DexPathList ä¸­çš„ Element æ•°ç»„ï¼Œä¾› ClassLoader ä½¿ç”¨ã€‚ æœ€åä½¿ç”¨dexfile::loaderåŠ è½½è§£å¯†åçš„dexæ–‡ä»¶\nå‚è€ƒæ–‡çŒ® https://bbs.kanxue.com/thread-191649.htm\nhttps://zhuanlan.zhihu.com/p/685239153\nhttps://x2d1.github.io/2025/04/09/bangbang_protect_1/#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%83%A8%E5%88%86\n",
  "wordCount" : "3951",
  "inLanguage": "zh",
  "datePublished": "2025-07-08T10:52:17+08:00",
  "dateModified": "2025-07-08T10:52:17+08:00",
  "author":[{
    "@type": "Person",
    "name": "simpson"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Simpson's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://SimpsonGet.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://SimpsonGet.github.io/zh/" accesskey="h" title="Simpson&#39;s Blog (Alt + H)">Simpson&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://SimpsonGet.github.io/zh/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://SimpsonGet.github.io/zh/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://SimpsonGet.github.io/zh/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://SimpsonGet.github.io/zh/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://SimpsonGet.github.io/zh/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://SimpsonGet.github.io/zh/posts/">Posts</a>&nbsp;Â»&nbsp;<a href="https://SimpsonGet.github.io/zh/posts/tech/">Tech</a></div>
    <h1 class="post-title entry-hint-parent">
      æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ
    </h1>
    <div class="post-description">
      æ¯”è¾ƒæ°´æ°´ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯æ›´ç€å…¶ä»–äººçš„åšå®¢åˆ†æäº†ä¸€è¾¹å…¶æ£€æµ‹ï¼Œå…³äºè§£å¯†å’ŒåŠ è½½dexçš„éƒ¨åˆ†æ²¡çœ‹
    </div>
    <div class="post-meta"><span title='2025-07-08 10:52:17 +0800 CST'>2025-07-08</span>&nbsp;Â·&nbsp;8 åˆ†é’Ÿ&nbsp;Â·&nbsp;simpson

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#java%e5%b1%82%e5%88%86%e6%9e%90" aria-label="javaå±‚åˆ†æ">javaå±‚åˆ†æ</a></li>
                <li>
                    <a href="#native%e5%b1%82%e5%88%86%e6%9e%90" aria-label="nativeå±‚åˆ†æ">nativeå±‚åˆ†æ</a><ul>
                        
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e8%a7%a3%e5%af%86%e5%90%8e%e7%9a%84so%e6%96%87%e4%bb%b6" aria-label="è·å–è§£å¯†åçš„soæ–‡ä»¶">è·å–è§£å¯†åçš„soæ–‡ä»¶</a></li>
                <li>
                    <a href="#%e5%88%86%e6%9e%90" aria-label="åˆ†æ">åˆ†æ</a><ul>
                        
                <li>
                    <a href="#libc%e7%ac%a6%e5%8f%b7%e8%a1%a8%e6%81%a2%e5%a4%8d" aria-label="libcç¬¦å·è¡¨æ¢å¤">libcç¬¦å·è¡¨æ¢å¤</a></li>
                <li>
                    <a href="#sub_52bc4%e6%a3%80%e6%b5%8bfrida" aria-label="ã€sub_52BC4ã€‘æ£€æµ‹frida">ã€sub_52BC4ã€‘æ£€æµ‹frida</a></li>
                <li>
                    <a href="#sub_4cb6c%e7%8e%af%e5%a2%83%e6%a3%80%e6%b5%8b" aria-label="ã€sub_4CB6Cã€‘ç¯å¢ƒæ£€æµ‹">ã€sub_4CB6Cã€‘ç¯å¢ƒæ£€æµ‹</a></li>
                <li>
                    <a href="#sub_52ea0java%e5%b1%82%e6%a3%80%e6%b5%8b" aria-label="ã€sub_52EA0ã€‘javaå±‚æ£€æµ‹">ã€sub_52EA0ã€‘javaå±‚æ£€æµ‹</a></li>
                <li>
                    <a href="#sub_4d638hook%e6%a1%86%e6%9e%b6%e6%a3%80%e6%b5%8b" aria-label="ã€sub_4D638ã€‘hookæ¡†æ¶æ£€æµ‹">ã€sub_4D638ã€‘hookæ¡†æ¶æ£€æµ‹</a></li>
                <li>
                    <a href="#sub_4e308%e8%99%9a%e6%8b%9f%e6%9c%ba%e6%a3%80%e6%b5%8b" aria-label="ã€sub_4E308ã€‘è™šæ‹Ÿæœºæ£€æµ‹">ã€sub_4E308ã€‘è™šæ‹Ÿæœºæ£€æµ‹</a></li>
                <li>
                    <a href="#sub_56c10%e8%b0%83%e8%af%95%e5%99%a8%e6%a3%80%e6%b5%8b" aria-label="ã€sub_56C10ã€‘è°ƒè¯•å™¨æ£€æµ‹">ã€sub_56C10ã€‘è°ƒè¯•å™¨æ£€æµ‹</a></li>
                <li>
                    <a href="#%e8%a7%a3%e5%af%86dex" aria-label="ã€è§£å¯†DEXã€‘">ã€è§£å¯†DEXã€‘</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae" aria-label="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><!-- more -->
<hr>
<p>æ ·æœ¬ï¼šè¶…æ˜Ÿå­¦ä¹ é€š[v6.5.9]</p>
<p>åŒ…åï¼šcom.chaoxing.mobile</p>
<hr>
<h2 id="javaå±‚åˆ†æ">javaå±‚åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#javaå±‚åˆ†æ">#</a></h2>
<p>æ¢†æ¢†åŠ å›ºç‰¹å¾</p>
<p><img alt="image-20250706105017905" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706105017905.png"></p>
<p>ç¨‹åºå…¥å£ç‚¹</p>
<p><img alt="image-20250706105239305" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706105239305.png"></p>
<p><img alt="image-20250706105259834" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706105259834.png"></p>
<p>æ ¹æ®ç³»ç»Ÿæ¶æ„é€‰æ‹©</p>
<p><img alt="image-20250706105531380" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706105531380.png"></p>
<p><img alt="image-20250706105543581" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706105543581.png"></p>
<p>åœ¨load()å‡½æ•°åï¼Œä½¿ç”¨doAttach()åˆ©ç”¨åå°„çš„æ‰‹æ®µè°ƒç”¨ä»£ç ï¼Œé‚£ä¹ˆlibDexHelper.soå³ä¸ºå¯¹åŸå§‹dexæ–‡ä»¶çš„é‡Šæ”¾</p>
<h2 id="nativeå±‚åˆ†æ">nativeå±‚åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#nativeå±‚åˆ†æ">#</a></h2>
<hr>
<p>soæ–‡ä»¶ï¼šlibDexHelper.so</p>
<hr>
<p>ç›´æ¥æ‰“å¼€apkä¸­çš„soæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°soæ–‡ä»¶è¢«åŠ å¯†</p>
<p><img alt="image-20250706110148997" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706110148997.png"></p>
<p><img alt="image-20250706110340401" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706110340401.png"></p>
<h3 id="è·å–è§£å¯†åçš„soæ–‡ä»¶">è·å–è§£å¯†åçš„soæ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#è·å–è§£å¯†åçš„soæ–‡ä»¶">#</a></h3>
<p>dumpè§£å¯†soæ–‡ä»¶çš„æ—¶æœº</p>
<p>åšæ–‡ç»™å‡ºçš„æ˜¯åœ¨android_dlopen_extæ—¶æœº</p>
<p>dumpçš„é€»è¾‘æ˜¯ä¿®æ”¹ç›®æ ‡æ®µçš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œå†å°†å†…å­˜è¯»åˆ°ç¼“å†²åŒºï¼Œå†™å…¥ç›®æ ‡åœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hook_dlopen</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">soName</span> <span class="o">=</span> <span class="s2">&#34;libDexHelper.so&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;android_dlopen_ext&#39;</span><span class="p">),{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">onEnter</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//arg[0] æ˜¯è¦åŠ è½½çš„soçš„è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="kd">let</span> <span class="nx">loadPath</span> <span class="o">=</span> <span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;dlopen call is: &#34;</span> <span class="o">+</span> <span class="nx">loadPath</span> <span class="o">+</span> <span class="s2">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">loadPath</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">soName</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                    <span class="k">this</span><span class="p">.</span><span class="nx">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span><span class="nx">onLeave</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;dlopen return\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">flag</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">dumpSo</span><span class="p">(</span><span class="nx">soName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">this</span><span class="p">.</span><span class="nx">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">dumpSo</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">Process</span><span class="p">.</span><span class="nx">getModuleByName</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[dump] start dumping ---------&#34;</span> <span class="o">+</span> <span class="nx">handle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">&#34;/data/data/com.chaoxing.mobile/&#34;</span> <span class="o">+</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">base</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nx">ptr</span><span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;.so&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">file_handle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s2">&#34;wb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_handle</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[dump] dump failed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Memory</span><span class="p">.</span><span class="nx">protect</span><span class="p">(</span><span class="nx">ptr</span><span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">base</span><span class="p">),</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="s1">&#39;rwx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">libbuffer</span> <span class="o">=</span> <span class="nx">ptr</span><span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">base</span><span class="p">).</span><span class="nx">readByteArray</span><span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_handle</span><span class="p">.</span><span class="nx">webkitRelativePath</span><span class="p">(</span><span class="nx">libbuffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_handle</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[dump] dump finished and path is: &#34;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setImmediate</span><span class="p">(</span><span class="nx">hook_dlopen</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250706112917728" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706112917728.png"></p>
<p>å†…å­˜ä¸­dumpä¸‹æ¥çš„soæ–‡ä»¶éœ€è¦è¿›è¡Œä¿®å¤ï¼Œè¿™é‡Œä½¿ç”¨sofixerä¿®å¤</p>
<p><img alt="image-20250706113332148" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706113332148.png"></p>
<p><img alt="image-20250706114348970" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706114348970.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sofixer  -s soruce.so -o fix.so -m 0x0 -d 
</span></span><span class="line"><span class="cl">-s å¾…ä¿®å¤çš„soè·¯å¾„
</span></span><span class="line"><span class="cl">-o ä¿®å¤åçš„soè·¯å¾„
</span></span><span class="line"><span class="cl">-m å…§å­˜dumpçš„åŸºåœ°å€<span class="o">(</span>16ä½<span class="o">)</span> 0xABC
</span></span><span class="line"><span class="cl">-d è¾“å‡ºdebugä¿¡æ¯
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®å¤å</p>
<p><img alt="image-20250706133733314" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706133733314.png"></p>
<p>è¿˜æœ‰ä¸€äº›å‡½æ•°åè¢«æ··æ·†ï¼Œç”¨idapythonæ¢å¤ä¸ºsub_offset</p>
<p><img alt="image-20250706133756733" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706133756733.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">idautils</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">idc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rename_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">func_ea</span> <span class="ow">in</span> <span class="n">idautils</span><span class="o">.</span><span class="n">Functions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">funcName</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_func_name</span><span class="p">(</span><span class="n">func_ea</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">funcName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;pS&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">funcName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;j_&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">funcName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;p5&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">editName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;sub_</span><span class="si">{</span><span class="n">func_ea</span><span class="si">:</span><span class="s2">X</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">idc</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">func_ea</span><span class="p">,</span> <span class="n">editName</span><span class="p">,</span> <span class="n">idc</span><span class="o">.</span><span class="n">SN_NOWARN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[Success] </span><span class="si">{</span><span class="n">funcName</span><span class="si">}</span><span class="s2"> ---&gt; </span><span class="si">{</span><span class="n">editName</span><span class="si">}</span><span class="s2"> in (0x</span><span class="si">{</span><span class="n">func_ea</span><span class="si">:</span><span class="s2">X</span><span class="si">}</span><span class="s2">)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rename_function</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250706135107295" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706135107295.png"></p>
<h3 id="åˆ†æ">åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#åˆ†æ">#</a></h3>
<p>JNI_Onloadä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">com/secneo/apkwrapper/H
</span></span><span class="line"><span class="cl">(Ljava/lang/String;)I
</span></span><span class="line"><span class="cl">(Ljava/lang/String;I)V
</span></span><span class="line"><span class="cl">(I)V
</span></span><span class="line"><span class="cl">(Ljava/lang/String;)Ljava/lang/String;  d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">com/secneo/apkwrapper/AW
</span></span><span class="line"><span class="cl">()V   pn
</span></span><span class="line"><span class="cl">(Landroid/content/Context;Landroid/app/Application;)V    hn
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>sub_3199Cå‡½æ•°é›†åˆäº†å„ç§æ£€æµ‹</strong></p>
<p><img alt="image-20250707180645302" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707180645302.png"></p>
<p>æœ‰å¾ˆå¤šè·³æ¿å‡½æ•°ï¼Œéœ€è¦ç»“åˆ<strong>0x71aeb83000</strong>å†…å­˜åŠ è½½åœ°å€å»è·³è½¬</p>
<p><img alt="image-20250706203027823" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706203027823.png"></p>
<p><strong>0x430C0</strong>å®ç°å¯¹ <code>libc.so</code> ä¸­ <code>readã€open64ã€openat64</code>ç­‰	å‡½æ•°çš„ hook æˆ–æ›¿æ¢ã€‚</p>
<p><img alt="image-20250706204436651" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706204436651.png"></p>
<p>sub_52BC4ä¸­</p>
<h4 id="libcç¬¦å·è¡¨æ¢å¤">libcç¬¦å·è¡¨æ¢å¤<a hidden class="anchor" aria-hidden="true" href="#libcç¬¦å·è¡¨æ¢å¤">#</a></h4>
<p>ä¸€äº›thunkå‡½æ•°0x7254D05110å…¶å®æ˜¯libcä¸­çš„</p>
<p>base = 0x7254c9a000</p>
<p><img alt="image-20250706211724494" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706211724494.png"></p>
<ul>
<li>å¯¼å‡ºlibcç¬¦å·è¡¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">nm -D libc.so <span class="p">&gt;</span> libc_symbols.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250706212803940" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706212803940.png"></p>
<ul>
<li>å¯¼å…¥åˆ°libdexhelpä¸­</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">idautils</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ida_bytes</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">idc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="mh">0x7254c9a000</span>  <span class="c1"># /proc/pid/maps/   è·å¾—</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_symbols</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./libc_symbols.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># å»æ‰ç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">            <span class="n">libc_symbols</span><span class="p">[</span><span class="n">libc_base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># éå†å½“å‰æ®µä¸­çš„ qword</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">ea</span> <span class="ow">in</span> <span class="n">idautils</span><span class="o">.</span><span class="n">Segments</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">segname</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_segm_name</span><span class="p">(</span><span class="n">ea</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;.data&#39;</span> <span class="ow">in</span> <span class="n">segname</span> <span class="ow">or</span> <span class="s1">&#39;.got&#39;</span> <span class="ow">in</span> <span class="n">segname</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_segm_start</span><span class="p">(</span><span class="n">ea</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">end</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_segm_end</span><span class="p">(</span><span class="n">ea</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>  <span class="c1"># 64ä½ç³»ç»Ÿ</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">idc</span><span class="o">.</span><span class="n">is_qword</span><span class="p">(</span><span class="n">ida_bytes</span><span class="o">.</span><span class="n">get_full_flags</span><span class="p">(</span><span class="n">addr</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="n">ptr_val</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_qword</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">ptr_val</span> <span class="ow">in</span> <span class="n">libc_symbols</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">libc_symbols</span><span class="p">[</span><span class="n">ptr_val</span><span class="p">]</span><span class="si">}</span><span class="s2">_ptr&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">idc</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">idc</span><span class="o">.</span><span class="n">SN_CHECK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[success] edit the </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2"> ---&gt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sub_52bc4æ£€æµ‹frida">ã€sub_52BC4ã€‘æ£€æµ‹frida<a hidden class="anchor" aria-hidden="true" href="#sub_52bc4æ£€æµ‹frida">#</a></h4>
<p><img alt="image-20250706214919893" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706214919893.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">//libcéƒ¨åˆ†å‡½æ•°çš„å‚æ•°åŠç”¨æ³•
</span></span><span class="line"><span class="cl">sendtoï¼ˆint sockfdï¼Œ const void *msgï¼Œint len , unsigned int flagsï¼Œ const struct sockaddr *toï¼Œ int tolenï¼‰
</span></span><span class="line"><span class="cl">//
</span></span><span class="line"><span class="cl">recvfromï¼ˆint sockfdï¼Œvoid *bufï¼Œint lenï¼Œunsigned int lagsï¼Œstruct sockaddr *fromï¼Œint *fromlen
</span></span><span class="line"><span class="cl">//
</span></span><span class="line"><span class="cl">access(const char* pathname, int mode)
</span></span><span class="line"><span class="cl">//æ£€æŸ¥è°ƒç”¨è¿›ç¨‹æ˜¯å¦èƒ½å¯¹pathnameæŒ‡å®šçš„æ–‡ä»¶ä½œmodeæ“ä½œï¼ŒæˆåŠŸæ‰§è¡Œè¿”å›0ï¼Œå¤±è´¥ä¸º-1
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">qword_EDE40  =
</span></span><span class="line"><span class="cl">GET/ws HTTP/1.1
</span></span><span class="line"><span class="cl">Upgrade: websocket
</span></span><span class="line"><span class="cl">Connection: Upgrade
</span></span><span class="line"><span class="cl">Sec-WebSocket-Key: nmmA32Q10Aqj2vWK
</span></span><span class="line"><span class="cl">w==
</span></span><span class="line"><span class="cl">Sec-WebSocket-Version: 13
</span></span><span class="line"><span class="cl">Host: 127.0.0.1:27042
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250706223027133" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706223027133.png"></p>
<p><img alt="image-20250706224856634" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706224856634.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">v16[0] = 2; 
</span></span><span class="line"><span class="cl">//è¿™ä¸ªèµ‹å€¼æ“ä½œçœ‹èµ·æ¥åƒæ˜¯è®¾ç½®æŸä¸ªåè®®æ—ï¼ˆfamilyï¼‰ã€‚
</span></span><span class="line"><span class="cl">åœ¨å¸¸è§çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒAF_INET çš„å€¼æ˜¯ 2ï¼Œè¡¨ç¤º IPv4 åœ°å€æ—ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ª sockaddr_in ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µ sin_familyã€‚
</span></span><span class="line"><span class="cl">v4 = 20000; è¿™ä¸ªå˜é‡ v4 è¢«è®¾ç½®ä¸º 20000ã€‚è€ƒè™‘åˆ°åç»­çš„æ“ä½œï¼Œè¿™ä¸ªå€¼å¾ˆå¯èƒ½æ˜¯ç”¨äºè®¾ç½®ç«¯å£å·ã€‚
</span></span><span class="line"><span class="cl">v16[1] = bswap32(v4) &gt;&gt; 16; è¿™é‡Œå¯¹ v4 è¿›è¡Œäº†å­—èŠ‚äº¤æ¢ (bswap32) å¹¶å³ç§» 16 ä½ã€‚å­—èŠ‚äº¤æ¢é€šå¸¸ç”¨äºå¤„ç†ä¸åŒå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œä»ä¸»æœºå­—èŠ‚åºåˆ°ç½‘ç»œå­—èŠ‚åºï¼‰ã€‚å‡è®¾ bswap32(v4) å°† v4 çš„å­—èŠ‚é¡ºåºåè½¬ï¼Œå¯¹äºå€¼ 20000ï¼ˆå³åå…­è¿›åˆ¶çš„ 0x4E20ï¼‰ï¼Œå…¶å­—èŠ‚äº¤æ¢åçš„ç»“æœä»ç„¶æ˜¯ 0x4E20ï¼ˆå› ä¸ºå®ƒæ˜¯32ä½æ•´æ•°ï¼Œä¸”é«˜ä½å­—èŠ‚ä¸ºé›¶ï¼‰ã€‚ç„¶åå°†å…¶å³ç§»16ä½ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ 0x0000ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®27042ç«¯å£ï¼Œå³ æœ¬åœ°çš„ Frida Server é»˜è®¤ç›‘å¬ç«¯å£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">è¿™æ®µä»£ç çš„è¡Œä¸º
</span></span><span class="line"><span class="cl">ç”¨ AUTH\r\n æ¢æµ‹æœåŠ¡æ˜¯å¦å¼€å¯
</span></span><span class="line"><span class="cl">å‘é€æ ‡å‡† WebSocket è¯·æ±‚åˆ° 127.0.0.1:27042ï¼Œåˆ†ææ˜¯å¦è¿”å› Sec-WebSocket-Acceptï¼Œåˆ¤æ–­ WebSocket æ˜¯å¦è¢«æ¥å—
</span></span><span class="line"><span class="cl">å¦‚æœæˆåŠŸï¼Œè¯´æ˜æœ¬åœ° Frida æ­£åœ¨è¿è¡Œï¼Œè¢«è¯†åˆ«
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sub_4cb6cç¯å¢ƒæ£€æµ‹">ã€sub_4CB6Cã€‘ç¯å¢ƒæ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#sub_4cb6cç¯å¢ƒæ£€æµ‹">#</a></h4>
<p><img alt="image-20250706231952403" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250706231952403.png"><img alt="image-20250707120543624" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707120543624.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">xmmword_C4200</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">v37_a</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">-</span><span class="n">num</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">common</span><span class="p">(</span><span class="n">oldstr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp2</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="o">+=</span> <span class="n">oldstr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oldstr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">oldstr</span><span class="p">[</span><span class="mi">17</span><span class="p">::]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">oldstr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">xmmword_C4200</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oldstr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">+=</span> <span class="n">tmp2</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">v37_1</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">v37</span> <span class="o">=</span>  <span class="s2">&#34;0uejp2/ersg2ed011pbiltm1ed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">a0uejp2Ersg2ed0</span> <span class="o">=</span> <span class="s2">&#34;0uejp2/ersg2ed011pbiltm1ed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[17], 3)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[18] ,1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[19] , 2)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[20] , 3)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[21] , 1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[22] , 2)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[23] , 3)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[24] , 1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># a(a0uejp2Ersg2ed0[25] , 2)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v37</span> <span class="o">=</span> <span class="s2">&#34;/uejp2/ersg2ed011magisk.db&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v37</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">v37</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">v37</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">v45_1</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">v45</span> <span class="o">=</span> <span class="s2">&#34;0uejp2/ersg2nkusqr&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v45</span> <span class="o">=</span> <span class="s2">&#34;/uejp2/ersg2nkusqr&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v45</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">v45</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">v45</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">v50_1</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">v50</span> <span class="o">=</span>  <span class="s2">&#34;0u|tvhn1ejp2ncjjuk&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v50</span> <span class="o">=</span> <span class="s2">&#34;/u|tvhn1ejp2ncjjuk&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v50</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">v50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">v50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v37 === &#34;</span><span class="p">,</span><span class="n">v37_1</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v45 === &#34;</span><span class="p">,</span><span class="n">v45_1</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v50 === &#34;</span><span class="p">,</span><span class="n">v50_1</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">/sbin/.core/db-0/magisk.db   .coreæ˜¯ä½¿ç”¨çš„éšè—ç›®å½•ï¼ŒåŒ…å«å…¶æ ¸å¿ƒè¿è¡Œæ—¶æ•°æ®ã€‚æ•°æ®åº“å­˜å‚¨è®¾ç½®å’Œrootæƒé™
</span></span><span class="line"><span class="cl">/sbin/.core/mirror		æ˜¯ Magisk çš„ä¸€ä¸ªå…³é”®åŠŸèƒ½ â€”â€” system-as-root é•œåƒæŒ‚è½½ç‚¹		
</span></span><span class="line"><span class="cl">/system/bin/magisk	æ˜¯ä¸»ç¨‹åº
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/system/usr/we-need-root/
</span></span><span class="line"><span class="cl">/system/bin/failsafe/
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ä¸€äº›å­—ç¬¦ä¸²çš„æ‹¼æ¥è§£å¯†è·å¾—æ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨<strong>accesså‡½æ•°</strong>åˆ¤æ–­</p>
<p>1ã€/sbin/.core/mirror</p>
<p>2ã€/data/local/su</p>
<p>3ã€/data/local/bin/su</p>
<p>4ã€ /data/local/xbin/su</p>
<p>5ã€/sbin/su</p>
<p>6ã€/su/bin/su</p>
<p>7ã€/system/bin/su</p>
<p>8ã€/system/bin/.ext/su</p>
<p>9ã€/system/bin/failsafe/su</p>
<p>10ã€/system/sd/xbin/su</p>
<p>11ã€/system/usr/we-need-root/su</p>
<p>12ã€/system/xbin/su</p>
<p>è°ƒç”¨ openat ä¸­æ–­è®¿é—®/proc/self/attr/prevæ–‡ä»¶è·å–æ•°å€¼ä¸å­—ç¬¦ä¸²u:r:zygote:s0æ¯”å¯¹è°ƒç”¨</p>
<p><strong>SELinux ä¸Šä¸‹æ–‡ï¼ˆSELinux Contextï¼‰æ£€æµ‹</strong>ï¼Œç”¨äºåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦è¿è¡Œåœ¨é¢„æœŸçš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">user:role:type:sensitivity
</span></span><span class="line"><span class="cl">u:r:zygote:s0 â†’ zygote è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/proc/self/attr/prev æ˜¯ä»€ä¹ˆï¼Ÿ
</span></span><span class="line"><span class="cl">è¿™æ˜¯ SELinux æä¾›çš„ä¸€ä¸ªæ¥å£æ–‡ä»¶ï¼Œè¡¨ç¤º å½“å‰è¿›ç¨‹çš„ä¸Šä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ­£å¸¸æƒ…å†µä¸‹ï¼ŒApp æ˜¯ç”± Zygote å¯åŠ¨çš„ï¼Œå®ƒçš„ prev ä¸Šä¸‹æ–‡æ˜¯ u:r:zygote:s0
</span></span><span class="line"><span class="cl">å¦‚æœä¿®æ”¹äº†å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡ su ææƒåå†å¯åŠ¨è¿™ä¸ª Appï¼Œé‚£ä¹ˆ prev ä¸Šä¸‹æ–‡å°±ä¼šå˜æˆ u:r:su:s0 æˆ–å…¶ä»–é zygote ä¸Šä¸‹æ–‡
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250707121037839" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707121037839.png"></p>
<p><code>ro.build.tags</code> ä¸»è¦ç”¨äºæ ‡è¯†æ„å»ºç±»å‹å¦‚æœæ£€æµ‹åˆ° <code>test-keys</code> è€Œä¸æ˜¯ <code>release-keys</code>ï¼Œåˆ™å¯èƒ½æç¤ºç”¨æˆ·å½“å‰ç³»ç»Ÿå­˜åœ¨æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚</p>
<p><img alt="image-20250707121143659" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707121143659.png"></p>
<h4 id="sub_52ea0javaå±‚æ£€æµ‹">ã€sub_52EA0ã€‘javaå±‚æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#sub_52ea0javaå±‚æ£€æµ‹">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">int pthread_create(pthread_t *thread,
</span></span><span class="line"><span class="cl">                   const pthread_attr_t *attr,
</span></span><span class="line"><span class="cl">                   void *(*start_routine) (void *),
</span></span><span class="line"><span class="cl">                   void *arg);
</span></span><span class="line"><span class="cl">//\3) void *(*start_routine) (void *)ï¼šä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æŒ‡æ˜æ–°å»ºçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°æœ€å¤šæœ‰ 1 ä¸ªï¼ˆå¯ä»¥çœç•¥ä¸å†™ï¼‰ï¼Œå½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹éƒ½å¿…é¡»ä¸º void* ç±»å‹ã€‚void* ç±»å‹åˆç§°ç©ºæŒ‡é’ˆç±»å‹ï¼Œè¡¨æ˜æŒ‡é’ˆæ‰€æŒ‡æ•°æ®çš„ç±»å‹æ˜¯æœªçŸ¥çš„ã€‚ä½¿ç”¨æ­¤ç±»å‹æŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å…ˆå¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç„¶åæ‰èƒ½æ­£å¸¸è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®pthread_createå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•å¾—x2å¯„å­˜å™¨å­˜æ”¾çš„sub_52EA0å‡½æ•°ï¼Œå…¶å®æ˜¯å°†è¦å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°åœ°å€</p>
<p><img alt="image-20250707160445295" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707160445295.png"></p>
<p>çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œsub_52EA0</p>
<p>è¿™è¾¹éœ€è¦æ ¹æ®æ±‡ç¼–æ‰‹åŠ¨æ¢å¤è¯¥å‡½æ•°çš„ç­¾åï¼ˆå› ä¸ºæ˜¯thunkè·³æ¿å‡½æ•°æ‰€ä»¥idaæ²¡æœ‰è‡ªåŠ¨è¯†åˆ«ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨idapythonå»åšè‡ªåŠ¨åŒ–æ‰¹é‡è®¾ç½®</p>
<p><img alt="image-20250707160858409" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707160858409.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl"> j_execl_ptr(&#34;/system/bin/app_process&#34;, &#34;/system/bin/app_process&#34;, &#34;/system/bin&#34;, â€œ--nice-name=zygisk.soâ€, &#34;com.secneo.apkwrapper.H&#34;, &#34;--write-fd&#34;, v12, &#34;--flags&#34;, 0, 0LL);
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250707165132755" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707165132755.png"></p>
<p>soå±‚é€šè¿‡excelå¯¹javaå±‚è¿›è¡Œæ£€æµ‹ï¼Œæ£€æµ‹tracepid</p>
<p>â€‹	<img alt="image-20250707165606851" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707165606851.png"></p>
<h4 id="sub_4d638hookæ¡†æ¶æ£€æµ‹">ã€sub_4D638ã€‘hookæ¡†æ¶æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#sub_4d638hookæ¡†æ¶æ£€æµ‹">#</a></h4>
<p>å¤ªå¤šäº†å°±æ¢å¤ä¸¤ä¸ªçœ‹çœ‹</p>
<p><img alt="image-20250707180123836" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707180123836.png"></p>
<p>isExportFunctionExistæ˜¯å¯¹ç›®æ ‡soä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼</p>
<p>é€šè¿‡mmapè¿›è¡Œæ˜ å°„åˆ°mapsä¸­ï¼Œä¸åŸæ¥å·²ç»åœ¨mapsçš„soåœ¨å†…å­˜ä¸­çš„å¯¼å‡ºå‡½æ•°è¿›è¡Œ<strong>æ¯”å¯¹å‰16ä¸ªå­—èŠ‚</strong>ï¼Œ</p>
<p>å¦‚æœæ¯”å¯¹ä¸ä¸€è‡´åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œå¦‚æœmapsæ²¡æœ‰è¿™ä¸ªsoåˆ™è¿”å›0ï¼Œå¦‚æœmapsä¸­æœ‰è¿™ä¸ªsoä½†æ²¡æœ‰è¿™ä¸ªè¦æœç´¢çš„å¯¼å‡ºå‡½æ•°åˆ™è¿”å›-1ã€‚</p>
<p><img alt="image-20250707174207789" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707174207789.png"></p>
<p>é€šè¿‡å¯¹æ¯”libart.soä¸­å¯¼å‡ºå‡½æ•°çš„å‰16å­—èŠ‚åˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p>
<p><img alt="image-20250707180538384" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707180538384.png"></p>
<p>æ£€æŸ¥ç¯å¢ƒå˜é‡ <code>CLASSPATH</code> æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦éç©ºã€ä¸”æ˜¯å¦é•¿åº¦å¤§äºç­‰äº 6ã€‚ä¸ºäº†åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯å¦è¢«æ³¨å…¥ã€æ˜¯å¦æ­£ç¡®è®¾ç½®ã€æ˜¯å¦ä¼ªè£…æˆåŠŸç­‰ã€‚</p>
<h4 id="sub_4e308è™šæ‹Ÿæœºæ£€æµ‹">ã€sub_4E308ã€‘è™šæ‹Ÿæœºæ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#sub_4e308è™šæ‹Ÿæœºæ£€æµ‹">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">åœ¨Androidå¼€å‘ä¸­ï¼Œå¯ä»¥é€šè¿‡cæ¥å£ç›´æ¥è·å–è®¾å¤‡å±æ€§ï¼Œç³»ç»Ÿæ¥å£ä¸ºï¼š
</span></span><span class="line"><span class="cl">int __system_property_get(const char* name, char* value)ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;ro.bluetooth.name&#34;, a1)
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;vmos.browser.home&#34;, a1)
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;vmprop.wifissid&#34;, a1)
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;ro.product.manufacturer&#34;, a1)
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;ro.product.model&#34;, a1)
</span></span><span class="line"><span class="cl">j___system_property_get_ptr(&#34;ro.product.manufacturer&#34;, a1)
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250707215501006" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707215501006.png"></p>
<p>ueventd.ttVM_x86.rcã€init.ttVM_x86.rcè¿™äº›æ˜¯ <strong>BlueStacks è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶</strong>ï¼Œä¸€èˆ¬ä¸ä¼šåœ¨çœŸå®è®¾å¤‡ä¸­å‡ºç°ã€‚</p>
<p>åˆ¤æ–­è¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ï¼Œ	 å…³é”®å­—åˆ¤æ–­ç­‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">#å…¶ä»–åšå®¢çš„æ€»ç»“
</span></span><span class="line"><span class="cl">è°ƒç”¨ _system_property_get(&#34;ro.bluetooth.name&#34;, resultAddr) 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              ro.ip.name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              ro.product.manufacturer         
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              ro.product.model
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸&#34;vmos&#34;ï¼ˆ&#34;vmos&#34;ä»£è¡¨è™šæ‹Ÿæœºï¼‰æ¯”è¾ƒ 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è°ƒç”¨ _system_property_get(&#34;vmos.browser.home&#34;, resultAddr) 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              vmos.camera.enable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              ro.vmos.simplest.rom
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              persist.vmos.setting.show
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              persist.vmos.tool.show
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸0x30ä½œæ¯”è¾ƒï¼ˆæ»¡è¶³ä¸€å®šçš„æ¡ä»¶resultAddrä¼šè¢«è‡ªåŠ¨èµ‹å€¼ä¸º0x30ï¼‰æ¯”è¾ƒï¼Œæ­¤å¤„æ˜¯æ¯”è¾ƒä¸ç›¸åŒ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è°ƒç”¨ _system_property_get(&#34;vmprop.wifissid&#34;, resultAddr)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è°ƒç”¨ _system_property_get(&#34;persist.vmos.root.enable&#34;, resultAddr)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è°ƒç”¨ _system_property_get(&#34;persist.vmos.root.show&#34;, resultAddr)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              persist.vmos.skills.show
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              persist.vmos.xposed.enable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              persist.vmos.xposed.show
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              ro.vmos.simplest.rom
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              vmos.camera.enable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸Šè¿°è°ƒç”¨_system_property_getè·å–å±æ€§å€¼ä¹‹åï¼Œå¦‚æœ_system_property_getçš„è¿”å›å€¼æ˜¯å¦å¤§äº0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è°ƒç”¨ access è®¿é—® /system/priv-app/vmos-pro-intent æ˜¯å¦å­˜åœ¨
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fopen æ‰“å¼€ //proc/version.osed.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²&#34;titan&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fopen æ‰“å¼€ //property_contexts.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²&#34;titan&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fopen æ‰“å¼€ //service_contexts æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²&#34;titan&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sub_56c10è°ƒè¯•å™¨æ£€æµ‹">ã€sub_56C10ã€‘è°ƒè¯•å™¨æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#sub_56c10è°ƒè¯•å™¨æ£€æµ‹">#</a></h4>
<p><img alt="image-20250707220529453" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707220529453.png"></p>
<p>é€šè¿‡foepn æ‰“å¼€/proc/pid/statusæ–‡ä»¶</p>
<p>è°ƒç”¨sleep(1)å¾ªç¯æ£€æŸ¥statusæ–‡ä»¶æ£€æµ‹â€œ<strong>state</strong>â€æ ‡å¿—å’Œ&quot;<strong>TracerPid:</strong>&ldquo;æ ‡å¿—</p>
<p>å¦‚æœè·å–çš„pidä¸ä¸º0ä¸”è·Ÿè°ƒç”¨getpidå‡½æ•°è·å–è‡ªèº«pidçš„<strong>ä¸ä¸€è‡´</strong>åˆ™è°ƒç”¨ä¸­æ–­ kill å…³é—­è°ƒè¯•è¿›ç¨‹</p>
<p><img alt="image-20250707220617802" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707220617802.png"></p>
<p><img alt="image-20250707221137436" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707221137436.png"></p>
<h4 id="è§£å¯†dex">ã€è§£å¯†DEXã€‘<a hidden class="anchor" aria-hidden="true" href="#è§£å¯†dex">#</a></h4>
<p><img alt="image-20250707222657087" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707222657087.png"></p>
<p>åŠ å¯†æ•°æ®å­˜æ”¾äºæœ€å¤§çš„dexä¸­ï¼Œæ ¹æ®dexdata0å®šä½</p>
<p><img alt="image-20250707222841856" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707222841856.png"></p>
<p>æ¯æ¬¡ç”³è¯·0x20000å¤§å°å¾ªç¯è§£å¯†</p>
<p><img alt="image-20250707223212286" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707223212286.png"></p>
<p>sub_38E04</p>
<p>ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šè¢«åŠ å¯†æ•°æ®çš„åœ°å€ã€å­˜æ”¾è§£å¯†åæ•°æ®çš„ä½ç½®ã€å‚ä¸è§£å¯†è¿ç®—çš„32å­—èŠ‚å¯†é’¥</p>
<p><img alt="image-20250707222939204" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707222939204.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">makeInMemoryDexElements çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š
</span></span><span class="line"><span class="cl">å°†å†…å­˜ä¸­çš„ DEX æ–‡ä»¶ï¼ˆæˆ– ZIP/APK ä¸­çš„ DEXï¼‰è½¬æ¢ä¸º DexPathList ä¸­çš„ Element æ•°ç»„ï¼Œä¾› ClassLoader ä½¿ç”¨ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image-20250707223344097" loading="lazy" src="/zh/posts/tech/bangbnagjiagu/image-20250707223344097.png"></p>
<p>æœ€åä½¿ç”¨dexfile::loaderåŠ è½½è§£å¯†åçš„dexæ–‡ä»¶</p>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒæ–‡çŒ®">#</a></h2>
<p><a href="https://bbs.kanxue.com/thread-191649.htm">https://bbs.kanxue.com/thread-191649.htm</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/685239153">https://zhuanlan.zhihu.com/p/685239153</a></p>
<p><a href="https://x2d1.github.io/2025/04/09/bangbang_protect_1/#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%83%A8%E5%88%86">https://x2d1.github.io/2025/04/09/bangbang_protect_1/#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%83%A8%E5%88%86</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://SimpsonGet.github.io/zh/tags/android/">Android</a></li>
      <li><a href="https://SimpsonGet.github.io/zh/tags/shell/">Shell</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://SimpsonGet.github.io/zh/posts/read/owasp/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Owasp Tpo 10 å­¦ä¹ </span>
  </a>
  <a class="next" href="https://SimpsonGet.github.io/zh/posts/tech/xhsunwatermark/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>xçº¢ä¹¦æ°´å°å»é™¤</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://SimpsonGet.github.io/zh/">Simpson&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
