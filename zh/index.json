[{"content":" æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººæŠ€æœ¯å­¦ä¹ ä¸ç ”ç©¶çš„è®°å½•ï¼Œæ—¨åœ¨åˆ†äº«é€†å‘åˆ†æçš„æ€è·¯å’Œæ–¹æ³•ï¼Œä¸æ¶‰åŠä¹Ÿä¸é¼“åŠ±ä»»ä½•å½¢å¼çš„å•†ä¸šç ´è§£ã€ç›—ç‰ˆä¼ æ’­æˆ–éæ³•ç”¨é€”ã€‚æ–‡ä¸­æ‰€æœ‰ç¤ºä¾‹ä¸æ“ä½œå‡å‡ºäºæŠ€æœ¯æ¢è®¨ç›®çš„ï¼Œä¸”æ¶‰åŠçš„å…³é”®ä¿¡æ¯å·²è¿›è¡Œè„±æ•å¤„ç†ï¼Œä¸ä¼šå½±å“æˆ–æ³„éœ²å®é™…è½¯ä»¶çš„å•†ä¸šåˆ©ç›Šã€‚\nå¦‚æœ‰å†…å®¹å­˜åœ¨ä¾µæƒæˆ–ä¸å½“ä¹‹å¤„ï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘å°†ç¬¬ä¸€æ—¶é—´åˆ é™¤æˆ–ä¿®æ­£ã€‚\né—®é¢˜ å¦‚å›¾ï¼Œæ—©ä¸Šæ‰“å¼€åŠå…¬è½¯ä»¶ï¼Œæ”¶åˆ°äº†æ–°è®¾ç½®ä¸è®©æˆªå›¾çš„é€šçŸ¥\næ‰“å¼€appä»»æ„ç•Œé¢æˆªå›¾çš„æ—¶å€™ï¼Œæç¤ºæ— æ³•æˆªå›¾\nåˆ†æ å®‰å“æä¾›appè®¾ç½®æˆªå›¾æƒé™çš„apiæœ‰\n1 2 3 4 5 6 7 1ã€setFlags(flags, mask) è¯¥æ–¹æ³•å±äº Windowï¼ˆé€šå¸¸é€šè¿‡ getWindow() è·å–ï¼‰ï¼Œè°ƒç”¨ setFlags(flags, mask) ä¼šå…ˆæ¸…é™¤ mask æŒ‡å®šçš„ä½ï¼Œç„¶åè®¾ç½® flags æŒ‡å®šçš„ä½ã€‚ å¸¸ç”¨äºï¼šè®¾ç½®æˆ–æ¸…é™¤çª—å£å±æ€§ï¼Œä¾‹å¦‚ç¦æ­¢æˆªå›¾ã€æ§åˆ¶çŠ¶æ€æ æ ·å¼ã€çª—å£å°ºå¯¸æ ¼å¼ç­‰ã€‚é€šè¿‡ getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE) å¯å½»åº•å¼€å¯ ä¸å…è®¸æˆªå›¾ åŠŸèƒ½ã€‚ 2ã€addFlags(flags) Window çš„æ–¹æ³•ï¼Œç”¨äºå‘å½“å‰å·²æœ‰çš„çª—å£æ ‡å¿—ä¸­â€œè¿½åŠ â€æŒ‡å®šçš„æ ‡å¿—ï¼Œå³åœ¨åŸæœ‰ flags åŸºç¡€ä¸Šé€šè¿‡ä½æˆ– (|) å¢åŠ æ–°çš„æ ‡å¿—ã€‚ å¸¸ç”¨äºï¼šä½¿ç”¨addFlags(flags)ä¸­è°ƒç”¨setFlags å½“flagè®¾ç½®ä¸º0x2000çš„æ—¶å€™ï¼Œå³ä¸ºè®¾ç½®äº†ä¸å…è®¸æˆªå›¾\nå¯¹ä¸Šè¿°api hook,å®šä½åˆ° è®¾ç½®çš„ä½ç½®\næ ¹æ®è°ƒç”¨æ ˆæ¨æµ‹ï¼Œåº”è¯¥æ˜¯ ä¼ä¸šè®¾ç½®äº† ä»¥åï¼Œåç«¯ä¼šå°†æŸä¸ªæ ‡å¿—æ•°æ®ä¸€èµ·ä¼ ç»™appï¼Œå½“appç™»å½•è¯¥ä¼ä¸šè´¦å·çš„æ—¶å€™å°±ä¼šæ›´æ–°è®¾ç½®\nè·Ÿè¸ªåˆ†æå¯ä»¥å‘ç°allPermissionData é‡Œé¢å°±åŒ…å«äº†å¯¹ æ˜¯å¦å…è®¸æˆªå›¾ çš„è®¾ç½®æ ‡å¿—\nè®¾ç½®çš„æ¡ä»¶æ˜¯æ ¹æ®è¿™ä¸ªjsonæ–‡ä»¶ä¸­å¯¹MOBILE_SCREEN_PROTECTçš„è®¾ç½®\nå®ƒæ˜¯ä½¿ç”¨ android.os.Handler å‘é€çš„è¿™ä¸ªjsonä¿¡æ¯ï¼Œhookç›¸å…³å‘é€çš„api ,å®šä½åˆ°å†™å…¥çš„åœ°æ–¹\n1 sendMessageAtTime(Message msg, long uptimeMillis) å¯¹åŒæ­¥æŠ“åŒ…ä¸­çš„æ•°æ®åŒ…è¯†åˆ«ï¼Œæ ¹æ®ä»£ç ä¸­çš„**\u0026ldquo;init\u0026rdquo;ã€â€api\u0026quot;**ç­‰å…³é”®å­—çŒœæµ‹å¤§æ¦‚ç‡æ˜¯è¿™ä¸ªä¼ å…¥è®¾ç½®\nè§£å†³æ–¹æ¡ˆ ç»•è¿‡å¾ˆç®€å•ï¼Œå¯¹setflags çš„hookä¿®æ”¹è¿”å›å³å¯\n1 2 3 var FLAG_SECURE = 0x2000; console.log(\u0026#34; \u0026gt;\u0026gt;\u0026gt; Removing FLAG_SECURE so screenshot is allowed \u0026lt;\u0026lt;\u0026lt;\u0026#34;); flags = flags \u0026amp; ~FLAG_SECURE; ç»“æœï¼šæ­£å¸¸æˆªå›¾\nç›®å‰å°±æ˜¯å®æ—¶çš„ç”¨fridaæµ‹è¯•äº†æ–¹æ¡ˆï¼Œå¦‚æœéœ€è¦é•¿æœŸèå…¥æ—¥å¸¸ä½¿ç”¨å¯ä»¥è½¬æ¢æˆxposedè„šæœ¬ï¼Œç»“åˆlspatchä¹Ÿå¯ä»¥åœ¨æ— rootçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚\nå¯¹äºå…¶ä»–ç¦æ­¢æˆªå›¾çš„APPæœ¬è´¨ä¸Šé‡‡ç”¨ä¸€æ ·çš„æ–¹æ³•ã€‚åº”è¯¥éƒ½å¯ä»¥ç»•è¿‡ã€‚å› ä¸ºæ‰‹æœºæˆªå›¾æ¯•ç«Ÿéƒ½å¾—ç”¨androidæœ¬èº«çš„apiï¼Œé‚£ä¹ˆç¦æ­¢çš„æ‰‹æ®µä¹Ÿæ˜¯ä¸å…¶ç›¸å…³ã€‚\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/feishu/","summary":"ä½¿ç”¨fridaç»•è¿‡APPç¦æ­¢æˆªå›¾çš„è®¾ç½®","title":"[ç ´è§£]é£book_ç¦æ­¢æˆªå›¾"},{"content":"å†…å­˜å¸ƒå±€æ£€æµ‹ â€‹\tunidbgçš„å†…å­˜å¸ƒå±€:\nâ€‹\tæ ˆå’Œå †çš„ç©ºé—´æ˜¯åœ¨memory.javaä¸­è®¾ç½®çš„ï¼Œ æ ˆè®¾ç½®ä¸€ä¸ªé«˜åœ°å€ä¸ºæ ˆåº•ï¼Œ å‘ä½åœ°å€å»¶ä¼¸ä½œä¸ºæ ˆç©ºé—´ã€‚ å †è®¾ç½®ä¸€ä¸ªä½åœ°å€ï¼Œ å‘é«˜åœ°å€å»¶ä¼¸ä½œä¸ºå †ç©ºé—´\nâ€‹\tä½†æ˜¯åœ¨çœŸæœºä¸Šï¼Œå †æ ˆåœ°å€æ›´é«˜ï¼Œè¿œé«˜äºunidbgè®¾ç½®çš„ï¼ˆå½“ç„¶unidbgå¯ä»¥è®¾ç½®ï¼‰\nä¸¤è€…æ¯”è¾ƒï¼Œunidbgçš„å †æ ˆåœ°å€æ˜¯å›ºå®šçš„ï¼Œæ¯æ¬¡è¿è¡Œä»–éƒ½æ˜¯åŸºäºmemory.javaä¸­è®¾ç½®çš„å»æ‰§è¡Œï¼Œå› æ­¤ä¸ç®¡è¿è¡Œå‡ æ¬¡éƒ½æ˜¯å›ºå®šçš„ç©ºé—´ï¼Œè¿™å¯ä»¥ä½œä¸ºç›‘æµ‹ç‚¹ã€‚ jniæ£€æµ‹ è°ƒç”¨æ£€æµ‹ â€‹\tunidbgä»£ç†äº†æ•´ä¸ªjavaå±‚ï¼Œå°†jniæ¡¥å‡½æ•°ä½äº0xfffe0000L - 0xffff0000Lï¼Œ æ¯ä¸ªè·³æ¿å‡½æ•°åªæœ‰8ä¸ªå­—èŠ‚ï¼ˆä¸­æ–­æŒ‡ä»¤ã€è¿”å›æŒ‡ä»¤ï¼‰\nâ€‹\tåœ¨çœŸæœºç¯å¢ƒä¸‹ï¼Œç›¸é‚»çš„jniæ¡¥å‡½æ•°ä¹‹é—´åƒä¸ªè‡³å°‘å‡ åä¸ªå­—èŠ‚\næ–¹æ³•æ£€æµ‹ â€‹\tunidbg å¤„ç†jniçš„é»˜è®¤ç­–ç•¥ï¼šä¼šå°†åœ¨è°ƒç”¨æ‰€æœ‰çš„ç±»/æ–¹æ³•æ—¶ï¼Œé»˜è®¤æˆåŠŸè·å–ã€‚å¦‚ findclassã€getmethodidç­‰å‡½æ•°ã€‚\nâ€‹\tæŠŠè¿™ä¸ªä½œä¸ºæ£€æµ‹ç‚¹çš„è¯ï¼Œå¯ä»¥åœ¨appä»£ç ä¸­æ·»åŠ ï¼Œä¸»åŠ¨å»æ‰¾ä¸å­˜åœ¨çš„ç±»ï¼Œåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°ã€‚ ä½†æ˜¯è¿™ä¸ªä½œä¸ºæ—¥å¿—è¾“å‡ºæ—¶æ¯”è¾ƒæ˜æ˜¾ï¼Œé‚£ä¹ˆå¯ä»¥å»å¯»æ‰¾ç³»ç»Ÿç±»ï¼Œä½†æ˜¯å°†å…¶ä¸­çš„å­—æ¯ä¿®æ”¹æˆè¿‘ä¼¼å­—ç¬¦æˆ–è€…ç©ºæ ¼ ç­‰éšè”½æ€§æ›´å¥½ï¼ˆå¦‚åœ¨getmethodidçš„æ—¶å€™ï¼Œä¿®æ”¹æ–¹æ³•ç­¾åï¼‰\nâ€‹\tåº”å¯¹æ‰‹æ®µï¼šunidbgæä¾›äº† addNotFoundClass å‡½æ•°ï¼Œä¸»åŠ¨å‘ŠçŸ¥unidbgç›®æ ‡ç±»ä¸åœ¨ä»£ç ä¸­ï¼Œ aceeptMethod å’Œ acceptFiledï¼ˆè¿™ä¸¤ä¸ªéœ€è¦é‡å†™æ–¹æ³•ï¼Œå»æŠ›å‡ºå¼‚å¸¸ï¼‰\næ–¹æ³•ID â€‹\tmethodIdï¼Œåœ¨çœŸæœºä¸­æ˜¯ä¸€ä¸ªæŒ‡å‘ArtMethodçš„ç»“æ„ä½“æŒ‡é’ˆï¼Œè€Œåœ¨unidbgï¼Œæ˜¯å¯¹æ–¹æ³•ç­¾åçš„ä¸€ä¸ªhashå€¼ã€‚ è¿™é‡Œçš„å¯¹æŠ—æ–¹æ³•å¯ä»¥ä¸»åŠ¨å»æ„é€ è®¡ç®—æ–¹æ³•çš„ç­¾åå¹¶è®¡ç®—å“ˆå¸Œï¼Œå¯¹æ¯”methodid\næ–‡ä»¶æè¿°ç¬¦ â€‹\tåœ¨çœŸæœºè®¾å¤‡ä¸­ï¼Œä½¿ç”¨openã€openatç­‰å¤„ç†æ–‡ä»¶çš„å‡½æ•°ï¼Œæ‰“å¼€æ–‡ä»¶ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚æ˜¯ä»0å¼€å§‹å‘æ­£å¢é•¿çš„ã€‚\nâ€‹\t0ã€1ã€2å¯¹åº”çš„åˆ†åˆ«æ˜¯æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯è¿™ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦\nâ€‹\tåœ¨çœŸæœºä¸­åŸºæœ¬ä¸Šéƒ½æœ‰åå‡ ä¸ªæ–‡ä»¶äº¤äº’ï¼Œé‚£ä¹ˆæ–‡ä»¶æè¿°ç¬¦éƒ½åœ¨20+\nâ€‹\tä½†æ˜¯åœ¨undibgä¸­åªæ¨¡æ‹Ÿäº†soï¼Œåªæœ‰012è¿™ä¸‰ä¸ªï¼Œé‚£ä¹ˆåé¢äº¤äº’çš„æ–‡ä»¶åŸºæœ¬ä¸Šéƒ½å°äº20\nunameæŒ‡ä»¤ â€‹\tunameæŒ‡ä»¤å¯ä»¥è¿”å›ç³»ç»Ÿä¿¡æ¯ã€ç‰ˆæœ¬ã€æ¶æ„ç­‰\nâ€‹\tunidbgè®¾è®¡çš„æ—¶å€™ä¸»æœºä¿¡æ¯è®¾ç½®çš„æ˜¯**\u0026ldquo;1.0.0.-unidbg\u0026rdquo;**\nâ€‹\tè¿™é‡Œçš„æ£€æµ‹ç‚¹æ˜¯å¯ä»¥ä¸»åŠ¨æ‰§è¡Œunameå‡½æ•°ï¼Œå¯¹æ¯”æ˜¯å¦å­˜åœ¨å…³é”®å­— â€œunidbg\u0026quot;\nâ€‹\tå½“ç„¶ï¼Œå¯¹æŠ—æ‰‹æ®µä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¿®æ”¹unidbgä»£ç ä¸­è¿™éƒ¨åˆ†çš„è¿”å›å€¼ä¸ºçœŸæœºçš„è¿”å›å€¼\nè¿è¡Œæ—¶é—´æ£€æµ‹ â€‹\tunidbgçš„æ¨¡æ‹Ÿæ‰§è¡Œæ•ˆç‡è¿œå¤§äºæ‰‹æœºçš„æ‰§è¡Œæ—¶é—´ï¼Œå¯ä»¥æ¯”å¯¹è¿™äº›æ—¶é—´ã€‚ä½†æ˜¯å®¹æ˜“è¯¯æŠ¥ä¸€äº›è€æ—§ç‰ˆæœ¬çš„æ‰‹æœºã€‚\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/unidbg_detect/","summary":"unidbg éƒ¨åˆ† æ£€æµ‹-å¯¹æŠ—æ‰‹æ®µ","title":"Unidbg æ£€æµ‹"},{"content":" åŒ…åï¼šY29tLm1vYmlsZS5sZWdlbmRz==\næˆ‘åœ¨åˆ†ææŸä¸€ä¸ªæ¸¸æˆappçš„æ—¶å€™ï¼Œéœ€è¦æŠ“å®ƒçš„åŒ…ï¼Œä½†æ˜¯æˆ‘åœ¨ä½¿ç”¨r0captureæˆ–è€…è‡ªå®ç°çš„socket Hookæ—¶ï¼Œåªhookåˆ°ä¸€ä¸¤ä¸ªåŒ…ï¼Œè¿™å®Œå…¨æ˜¯ä¸æ­£å¸¸çš„ã€‚\næŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹ï¼Œå‘ç°æœ‰å­è¿›ç¨‹çš„ï¼Œæ˜¾è€Œæ˜“è§ï¼Œå…·ä½“çš„å®ç°å…¶å®éƒ½åœ¨ç¬¬äºŒä¸ªé‡Œé¢ã€‚\nè¿™é‡Œå¯ä»¥ç†è§£æˆåƒæ˜¯çƒ­æ›´æ–°ç­‰ï¼Œçœ‹æ˜¯è¿è¡Œçš„æ˜¯A.dexï¼Œå…¶å®åŠ¨æ€åŠ è½½è¿è¡Œäº†B.dexï¼Œå¾ˆå¤šæ¸¸æˆéƒ½æ˜¯è¿™æ ·å­çš„å†™æ³•ï¼Œä¹‹åé‡åˆ°äº†å‘ç°ä¸æ­£å¸¸çš„hookç»“æœçš„è¯ï¼Œå°±å¯ä»¥æƒ³åˆ°è¿™ä¸€ç‚¹ã€‚ï¼ˆæ–°å§¿åŠ¿+1ï¼‰\nè¿™é‡Œå¼•å…¥ä¸€ä¸‹frida Child Gatingæœºåˆ¶\nChild Gating ç®€å•æ¥è¯´ï¼Œè¿™æ˜¯fridaçš„ä¸€ä¸ªæœºåˆ¶ï¼Œå®ƒä¸»è¦çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨æƒ³è¦hookçš„æ“ä½œåœ¨å­è¿›ç¨‹ä¸­æ—¶ã€‚\nåœ¨ä¸»è¿›ç¨‹è¿›è¡Œå­è¿›ç¨‹åˆ›å»ºçš„æ“ä½œæ—¶ï¼Œå°†è¿™ä¸ªæ“ä½œæŒ‚èµ·ï¼Œç„¶åé€šè¿‡å›è°ƒæ³¨å…¥fridaçš„è„šæœ¬ï¼Œå†æ¢å¤ã€‚\nç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #å¯¹çˆ¶è¿›ç¨‹çš„é™„åŠ ï¼Œå’Œå¯ç”¨child_gatingåŠŸèƒ½ session = device.attach(pid) session.enable_child_gating() #æ¥æ”¶å­è¿›ç¨‹åˆ›å»ºçš„é€šçŸ¥ï¼Œä»¥åŠåˆ›å»ºå›è°ƒå‡½æ•° device.on(\u0026#34;child-added\u0026#34;, on_child_added) device.on(\u0026#34;child-removed\u0026#34;, on_child_removed) def on_child_added(child): # Attach to the child process session = device.attach(child.pid) # Enable child gating for this process too (if needed) session.enable_child_gating() # Create and load script script = session.create_script(...) script.load() # Resume the child process device.resume(child.pid) ä½†æ˜¯å‘¢ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œåœ¨å†™å¥½æµ‹è¯•ä»¥åæ‰å‘ç°ï¼Œchild.pidä¸€ç›´æ²¡æœ‰è¯†åˆ«åˆ°ps -efä¸€æ ·çš„å­è¿›ç¨‹ï¼ˆæœ‰ä¸€äº›å…¶ä»–çš„ï¼‰ã€‚\nè¿™æ˜¯å› ä¸ºï¼šchild_gating åªèƒ½è¯†åˆ«ç”±å·²å¼€å¯ enable_child_gating çš„è¿›ç¨‹ç›´æ¥ fork() å‡ºæ¥çš„å­è¿›ç¨‹ï¼Œå³ ppid å¿…é¡»æ˜¯çˆ¶è¿›ç¨‹æœ¬èº«ã€‚ä½†åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œè™½ç„¶è¿›ç¨‹ A å¯åŠ¨äº†è¿›ç¨‹ Bï¼Œä½† B å®é™…ä¸Šæ˜¯é€šè¿‡ A è°ƒç”¨ç³»ç»ŸæœåŠ¡è¯·æ±‚ zygote è¿›è¡Œ fork çš„ï¼Œå› æ­¤ B çš„ ppid æ˜¯ zygote è€Œä¸æ˜¯ Aï¼Œchild_gating æ— æ³•ç”Ÿæ•ˆã€‚\nåœ¨ Android ä¸­ï¼ŒApp å¯åŠ¨é€šå¸¸å¹¶ä¸æ˜¯ç”±å·²æœ‰ App è‡ªè¡Œ fork å­è¿›ç¨‹å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡ Binder è°ƒç”¨ system_server â†’ activity_manager â†’ zygote forkã€‚è¿™ç§æ¶æ„ä½¿å¾—å³ä¾¿è¿›ç¨‹ A è§¦å‘äº†è¿›ç¨‹ B çš„åˆ›å»ºï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿä¸æ˜¯çˆ¶å­è¿›ç¨‹å…³ç³»ã€‚\nwhile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 # -*- coding: utf-8 -*- from __future__ import print_function import threading import time import frida from frida_tools.application import Reactor import subprocess import sys package = \u0026#34;com.m***e.l****s\u0026#34; child_gating = package + \u0026#34;:U**tyK**s**\u0026#34; script_path = \u0026#34;*******\\hook_socket.js\u0026#34; log_file = \u0026#39;******\\\\frida_console2.log\u0026#39; class Application(object): def __init__(self): self._stop_requested = threading.Event() self._reactor = Reactor(run_until_return=lambda reactor: self._stop_requested.wait()) self._device = frida.get_usb_device() self._sessions = set() def run(self): self._reactor.schedule(lambda: self._start()) self._reactor.run() def _start(self): self._device = frida.get_usb_device() #å…ˆå¯åŠ¨çˆ¶è¿›ç¨‹ print(\u0026#34;âœ” spawn \u0026#34; + package) pid = self._device.spawn([package]) print(f\u0026#34;âœ” resume(pid={pid})\u0026#34;) self._device.resume(pid) print(\u0026#34;â³ ç­‰å¾…å­è¿›ç¨‹...\u0026#34;) target_pid = None while True: result = subprocess.run([\u0026#34;adb\u0026#34;, \u0026#34;shell\u0026#34;, \u0026#34;ps\u0026#34;, \u0026#34;-ef\u0026#34;], stdout=subprocess.PIPE, text=True) lines = [line for line in result.stdout.splitlines() if package in line] if len(lines) \u0026gt;= 2: target_pid = lines[1].split()[1] # ç¬¬äºŒä¸ªåŒ¹é…è¡Œï¼Œå– PID print(f\u0026#34;âœ… æ‰¾åˆ°ç›®æ ‡å­è¿›ç¨‹ PID: {target_pid}\u0026#34;) break else: print(\u0026#34;ğŸ” æœªæ‰¾åˆ°ç¬¬äºŒä¸ªè¿›ç¨‹ï¼Œç»§ç»­ç­‰å¾…...\u0026#34;) time.sleep(1) self._instrument(int(target_pid)) def _instrument(self, target_pid): cmd = [ \u0026#34;frida\u0026#34;, \u0026#34;-U\u0026#34;, \u0026#34;-p\u0026#34;, str(target_pid), \u0026#34;-l\u0026#34;, script_path, \u0026#34;-o\u0026#34;, log_file ] # cmd = [ # \u0026#34;python\u0026#34;, # \u0026#34;D:\\\\tools\\\\r0capture\\\\r0capture.py\u0026#34;, # \u0026#34;-U\u0026#34;, # str(target_pid) # ] # å¯åŠ¨å¹¶é™„åŠ åˆ°è¿›ç¨‹ subprocess.run(cmd) def _on_detached(self, pid, session, reason): print(f\u0026#34;âš¡ detached: pid={pid}, reason=\u0026#39;{reason}\u0026#39;\u0026#34;) self._sessions.remove(session) self._reactor.schedule(self._stop_if_idle, delay=0.5) app = Application() app.run() æœ€åå°±æ˜¯é‡‡ç”¨çš„è¿™ç§å¾ªç¯æŸ¥çœ‹è¿›ç¨‹ï¼Œç›´åˆ°çŸ¥é“ç¬¬äºŒä¸ªè¿›ç¨‹å†ä½¿ç”¨-pæ‰§è¡Œfridaè„šæœ¬\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/childgating/","summary":"frida hookä¸åˆ°ï¼Ÿä¸åº”è¯¥å•Šï¼Ÿï¼å°è¯•ä¸€ä¸‹è¿™ä¸ªï¼","title":"Frida Hook å­è¿›ç¨‹"},{"content":" com.shizhuang.duapp\n5.71.0\næ€»ä½“æ¥è¯´ï¼ŒåŠ å¯†ç®—æ³•æ˜¯å¸¸è§„çš„ï¼Œè¿™æ¬¡æ ·æœ¬çš„å­¦ä¹ çš„åœ°æ–¹å°±æ˜¯å¯¹VMPå£³çš„å¤„ç†æ‰‹æ®µï¼ˆç›´æ¥å¯¹jniå‡½æ•°çš„traceã€hookç»•è¿‡å£³å’Œæ··æ·†ã€‚æ›´æ·±å…¥çš„vmpè¿˜éœ€ç»§ç»­å­¦ä¹ ï¼‰ æœç´¢éƒ¨åˆ†è¿˜æœ‰å›¾å½¢éªŒè¯ç ï¼Œæ•°æ®ä¹Ÿæ˜¯åŠ å¯†çš„\nå…ˆçœ‹çœ‹è¿™ä¸ªçƒ­æ¦œçš„æ¥å£ï¼Œå’Œé‚£äº›æœ‰å…±åŒçš„new sign\nç›´æ¥pythonï¼Œå¯ä»¥å¤ç°\nheaderçš„å‚æ•°éƒ½ä¸ newsignæœ‰å…³ï¼Œè€Œè·å–æ¯å¤©çš„çƒ­æ¦œè‚¯å®šä¸æ—¶é—´æˆ³æ˜¯æœ‰å…³ç³»çš„ï¼Œæ‰€ä»¥ç°åœ¨åˆ†ænewsignçš„ç”Ÿæˆï¼Œåç»­å°±å¯ä»¥è·å–æ¯å¤©çš„çƒ­æ¦œ\nnewSignåˆ†æ æ ¹æ®çƒ­æ¦œçš„æŠ¥æ–‡æ˜¯GETæ‰€ä»¥è¿™é‡Œå®šä½çš„æ˜¯ä¸Šå›¾ä¸­çš„ç¬¬ä¸€ä¸ªæ¡\nè¿‡fridaæ£€æµ‹ å¾—ç‰©æœ‰fridaæ£€æµ‹ï¼Œå¼€å¯fridaè½¯ä»¶ç›´æ¥é—ªé€€äº†\nçœ‹äº†ä¸€ä¸‹ä¹Ÿæ˜¯é‚£ä¸€å¥—æ£€æµ‹ï¼Œç›´æ¥hook dlopen å°†åˆ›å»ºpthread_createçš„å‡½æ•°ç½®ç©º\nnewSignä¸€è‡´ï¼ŒéªŒè¯ä¸Šé¢å®šä½æ­£ç¡®\njavaåˆ†æ æ€»ç»“ï¼š ä»¥loginTokenã€platformã€timestampã€uuidã€vä»¥åŠå¯¹åº”çš„å€¼æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼Œé€šè¿‡jniå‡½æ•°ILå¾—åˆ°ç»“æœï¼Œåœ¨è¿›è¡Œmd5ï¼Œä¸ºæœ€ç»ˆç»“æœ æ ¹æ®hookçš„ç»“æœx0.h()å‚æ•°strå¦‚ä¸‹ï¼š\nï¼Ÿä½†æ˜¯æ ¹æ®ä»£ç ä¸­çš„é€»è¾‘ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸ºç©ºçš„ (åº”è¯¥æ˜¯çƒ­ä¿®å¤æ›¿æ¢äº†)\n1 76dd135c07ed833c********9ca6b5d85f471b44a42bb382bbaad346f37b0d3193b22470362bf4b267f4f8f30b88b0b1d69dc1f8******1508292aa7869f1793|2622023754|1753003762|33f8c808aab40b67590da0565ab9115096841217|1-0|d41d8cd903d0336c x0.hå‡½æ•°å¦‚ä¸‹\næ ¸å¿ƒé€»è¾‘å†JNIå‡½æ•° ILä¸­\ndex vmpçš„ç‰¹å¾\n1 2 3 4 ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶å®å°±æ˜¯ä»£è¡¨äº†å½“å‰è¿™ä¸ªå‡½æ•°ï¼Œç”¨è¿™ä¸ªæ•°å­—æ¥ç´¢å¼•å·²ç»è¢«è™šæ‹ŸåŒ–çš„ä»£ç æ¥æ‰§è¡Œã€‚ ä½¿ç”¨äº†å¤§é‡çš„jniå‡½æ•°è€Œä¸”ï¼Œæ²¡æœ‰ä»€ä¹ˆåˆ«çš„å‡½æ•° å†™æˆé€šç”¨çš„cæˆè°ƒç”¨ä»»ä½•javaæ–¹æ³•çš„åŠŸèƒ½ å…·æœ‰å¸¸é‡å‡½æ•°åˆ—è¡¨ å°†jniå‡½æ•°è¿”å›å€¼è¿›è¡Œmd5åŠ å¯†ï¼Œå°±è·å¾—äº†æœ€ç»ˆçš„newSignçš„å€¼\nç»éªŒè¯ï¼Œkï¼ˆï¼‰æ˜¯å¸¸è§„md5\n1 str=loginToken76dd135c07ed833c*********addba567339ca6b5d85f471b44a42bb382bbaad346f37b0d3193b22470362bf4b267f4f8f30b88b******5f7dcec6f1508292aa7869f1793|2622023754|1753003762|33f8c808aab40b67590da0565ab9115096841217|1-0|d41d**cplatformandroidtimestamp1753082568871uuide31c***77*1061v5.71.0 è·å¾—contextçš„ç±»å‹ä¸ºcom.shizhuang.duapp.modules.app.DuApplication\nå°†hookåˆ°çš„æ•°æ®å’ŒæŠ¥æ–‡æ•°æ®å¯¹æ¯”ï¼Œå¦‚ä¸‹è¿™äº›å€¼æ˜¯ç›¸å…³çš„ï¼Œlogintokenéœ€è¦çœ‹æ¥æº\nå‡½æ•°å‚æ•° æŠ¥æ–‡æ•°æ® å€¼ loginToken duloginToken 76dd135c07ï¼Ÿï¼Ÿï¼Ÿ5f471b44a42bb382bbaad346f3ï¼Ÿï¼Ÿï¼Ÿb88b0b1d69dc1f8f73115f7dcec6f1508292aa7869f1793 timestamp timestamp 175308256887 platform duplatform android v duv 5.71.0 æºæ•°æ® logintoken logintoken æ˜¯ ä¼ å…¥çš„strï¼ŒæŒ‰ç†æ¥è¯´javaå±‚åˆ†æåˆ°æ˜¯ç©ºçš„ï¼Œä½†æ˜¯å®é™…ä¸æ˜¯ä¹Ÿä¸å¯èƒ½æ˜¯ç©ºçš„\nå¤§æ¦‚ç‡æ˜¯è¿›å…¥äº†çƒ­ä¿®å¤æ¡†æ¶ä¸­æ›¿æ¢äº†str\nuuid ä½¿ç”¨ç¾å›¢çš„çƒ­ä¿®å¤æ¡†æ¶\nä¸è¿‡è¿™é‡Œå¤šæ¬¡æµ‹è¯•éƒ½æ˜¯å›ºå®šå€¼ï¼Œå°±ä¸ç»§ç»­çœ‹äº†\nnative lib: libGameVMP.so\nmethod_name:IL\noffset: 0xdac0\nå…ˆåˆ†æILå‡½æ•°\nsoæ–‡ä»¶ä¿®å¤ soæ–‡ä»¶åº”è¯¥è¢«åŠ å¯†äº†ï¼Œéœ€è¦ä»å†…å­˜dumpï¼Œ+ä¿®å¤\nåœ¨æœ¬æœºä¸Š\nso_base = 0x741ac05000\nso_size = 0x77000\nç”¨sofixerä¿®å¤\nnewway frida-dump\nè¿™ä¸ªå·¥å…·æ•´åˆäº†å‰é¢çš„äººå·¥ä¸€æ­¥æ­¥çš„æ­¥éª¤\nILå‡½æ•°åˆ†æ 1 2 3 public static String doWork(Object obj, String str) { return (String) NCall.IL(new Object[]{362, obj, str}); } å‚æ•°æ˜¯ç”±ä¸‰éƒ¨åˆ†æ„æˆçš„ï¼Œobjä¸ºcontext\né’ˆå¯¹VMPå£³ï¼Œéœ€è¦è·å¾—JNIå‡½æ•°åœ¨å†…å­˜çš„åœ°å€å»åˆ†æï¼Ÿï¼Ÿï¼Ÿ\nè™šå‡æ§åˆ¶æµçš„ ollvmï¼Œ è¿™é‡Œxï¼Œyè¿™äº›å…¨å±€å˜é‡å°±ç”¨ä½œä¸é€æ˜è°“è¯ï¼Œå¯¹äºè¿™ç§éœ€è¦traceæ‰¾åˆ°çœŸå®è·¯å¾„å¹¶åˆ†æ\nå®šå‚åˆ†æ å›ºå®šå‚æ•°ä¸»åŠ¨è°ƒç”¨ï¼Œæ–¹ä¾¿åç»­åˆ†æ\nå› ä¸ºæœ€ç»ˆçš„ç»“æœnativeè¿˜æ˜¯å¾—é€šè¿‡jstringçš„å½¢å¼è¿”å›ï¼Œé‚£ä¹ˆå»hookç›¸å…³çš„jniæ¥å£å»å®šä½å®ƒï¼Œè¿™æ ·åšå¯ä»¥å‡å°‘vmpå£³å’Œæ··æ·†çš„å¹²æ‰°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #ç›¸å…³jstringå¤„ç†å‡½æ•° jstring (*NewString)(JNIEnv*, const jchar*, jsize); jsize (*GetStringLength)(JNIEnv*, jstring); const jchar* (*GetStringChars)(JNIEnv*, jstring, jboolean*); void (*ReleaseStringChars)(JNIEnv*, jstring, const jchar*); jstring (*NewStringUTF)(JNIEnv*, const char*); jsize (*GetStringUTFLength)(JNIEnv*, jstring); /* JNI spec says this returns const jbyte*, but that\u0026#39;s inconsistent */ const char* (*GetStringUTFChars)(JNIEnv*, jstring, jboolean*); void (*ReleaseStringUTFChars)(JNIEnv*, jstring, const char*); jsize (*GetArrayLength)(JNIEnv*, jarray); jobjectArray (*NewObjectArray)(JNIEnv*, jsize, jclass, jobject); jobject (*GetObjectArrayElement)(JNIEnv*, jobjectArray, jsize); void (*SetObjectArrayElement)(JNIEnv*, jobjectArray, jsize, jobject); åœ¨ libdewuhelper.so!encode+0x138!+0x185c è°ƒç”¨äº†NewStringUTFæ–¹æ³•æ„å»ºäº†å­—ç¬¦ä¸²\nnative-2 lib:libdewuhelper\noffset:0x185c\nmethodname:encode\nåŒä¸Šè¿°nativeä¸­ä¸€æ ·dump+ä¿®å¤ï¼Œæ‰¾åˆ°è°ƒç”¨ä½ç½®\nhook encodeå‡½æ•°\n1 2 3 a3å°±æ˜¯javaè¾“å…¥çš„objectä¸­çš„str a4æ˜¯ä½ç½®01ç»„æˆçš„å­—ç¬¦ä¸² â€œ010110100010001010010010000011000111001011101010101000101110111010011010101101101010001000101100010110100010001010011010110011001111001011100010101000100100110010110010100010101011110010111100â€ a4æ˜¯ç»™getvalueç”¨çš„ï¼Ÿå› ä¸ºä¸€ä¸ªå‚æ•°\nè¿™ä¸ªæ˜¯å°† 8 å­—èŠ‚å‹ç¼©æˆä¸€ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨äº†ä¸€ç§éå¯¹ç§°åŠ æƒç´¯åŠ æ··æ·†ç®—æ³•ã€‚ç±»ä¼¼äºè‡ªå®šä¹‰ base256 ç¼–ç ï¼ˆéæ ‡å‡†ï¼‰ï¼Œå¹¶åœ¨ç»“æœä¸ŠåŠ  48ã€‚ __int64 __fastcall getValue(const char *a1)\ngetvalueæŒ‡å‘0x160Cå¤„çš„getValueï¼Œå°è¯•hook\nå¯†é’¥å°±æ˜¯d2*****78a61å—ï¼Ÿï¼Ÿï¼ˆå› ä¸ºä¸­é—´æ²¡æœ‰å…¶ä»–æ“ä½œï¼Œç›´æ¥hook ä¸‹é¢è¿™ä¸ªaesçš„å‚æ•°è·å–å‚æ•°ä¸€æ ·ï¼‰\næ˜¯å¸¸è§„aeså—ï¼Ÿï¼Ÿï¼Ÿ hookè¿™ä¸ªä½ç½®éªŒè¯ä¸€ä¸‹ï¼ˆæ˜¯çš„ï¼‰\nç›´æ¥å°†v11ï¼Œvalueé€šè¿‡cybercheféªŒè¯æ˜¯ä¸å¯¹çš„~~ï¼ˆé­”æ”¹è¿‡ï¼Ÿï¼‰~~\næœ€åè¿›è¡Œäº†base64ç¼–ç \naesåˆ†æ å¹³å¦åŒ–æ··æ·†çš„ç®—æ³•\nå°†å‚æ•°å¤„ç†åæœ€åè°ƒç”¨çš„æ˜¯AES128_ECB_encrypt\nç›´æ¥hookAES128_ECB_encrypt\né‚£å…¶å®è¿™é‡Œçš„åˆ†ææ²¡æœ‰æ„ä¹‰ï¼Œç›´æ¥hookæœ€åˆçš„j_xxxï¼Œå¾—åˆ°çš„è¿”å›å€¼å°±æ˜¯äº†ï¼Œå› ä¸ºå®ƒæœ¬èº«ä¹Ÿå°±æ˜¯åŸå§‹aes\nå‚æ•°åˆ†æ 1 v18 = (char *)j_AES_128_ECB_PKCS5Padding_Encrypt(v11, Value); [v11]\nå°±æ˜¯javaä¼ å…¥çš„str\n[value]\nå¯†é’¥å˜ç›¸ç¡¬ç¼–ç ï¼Œè™½ç„¶æ˜¯é€šè¿‡getvalueå¾—åˆ°çš„ï¼Œä½†æ˜¯ä¼ å…¥çš„stræ˜¯ä¸€æ ·çš„\nè¯·æ±‚è¿˜åŸ æ ¹æ®å‰é¢çš„åˆ†æï¼Œåœ¨è¯·æ±‚å¾—ç‰©çƒ­æ¦œçš„æ—¶å€™ï¼ŒæŠ¥æ–‡ä¸­åªæœ‰ä¸€ä¸‹å››ä¸ªå€¼å’Œsignç›¸å…³\nè¿™äº›æ˜¯å¿…è¦å¤´\næˆåŠŸè¿˜åŸ\næ›´æ”¹å‚æ•°ç”ŸæˆåæˆåŠŸæ‹‰å»æ±‚å“åº”\nå‚è€ƒ https://so.csdn.net/so/search?q=libgamevmp\u0026t=blog\u0026u=linchaolong\nhttps://mp.weixin.qq.com/s/x6xIZ3cQ8fsVRpWORC45HA\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/du/","summary":"ç¬¬ä¸€æ¬¡çœŸå®é‡åˆ°VMPå£³ï¼Œå­¦ä¹ ä¸€äº›é€†å‘æ‰‹æ®µ","title":"ã€VMPåˆæ¢ã€‘æŸç”µå•†signå€¼åˆ†æ"},{"content":" è½¯ä»¶ï¼šå”¯å“ä¼š\nåŒ…åï¼šcom.achievo.vipshop\nç‰ˆæœ¬ 9.42.8\nåˆ†æå‚æ•°ï¼šauthorization åˆ é™¤äº†authorization è¯·æ±‚å¤´ï¼Œä½¿ç”¨pythonå¤ç°æŠ¥æ–‡çš„ç»“æœ\nå½“æŠŠæœç´¢å‚æ•°â€œè¡£æœâ€ æ”¹ä¸ºâ€è£¤å­â€œåå°±ä¸èƒ½äº†ï¼Œ åº”è¯¥æ˜¯authorizationæ˜¯æ ¹æ®postå†…çš„ä¸€äº›å€¼ç”Ÿæˆçš„ï¼Œä¼¼ä¹æ˜¯æ‰€æœ‰å€¼ï¼ˆç»“æœè¯æ˜æ˜¯å¯¹çš„ï¼‰\njavaå±‚ ç›´æ¥å…³é”®å­—æœç´¢å°±æ‰¾äº†ï¼Œçœçš„å»hook hashæˆ–è€…header\ncom.achievo.vipshop.commons.api.middleware.api.refector-process\ntreeMap ä½œä¸ºpostçš„å‚æ•°\nè¿™é‡Œæ˜¯é‡‡ç”¨çš„javaåå°„è°ƒç”¨\nhookåå°„å‡½æ•°ï¼Œæ‰¾åˆ°çœŸå®ç±»ï¼ˆä»£ç å¾€ä¸‹ç¿»ä¹Ÿæ˜¯æœ‰çš„ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function hook_reflect(){ Java.perform(function () { const Method = Java.use(\u0026#39;java.lang.reflect.Method\u0026#39;); Method.invoke.implementation = function (obj, args) { const methodName = this.getName(); if (methodName === \u0026#39;gs\u0026#39;) { console.log(\u0026#34;\\n[+] æ•è·åˆ°å¯¹ \u0026#39;gs\u0026#39; æ–¹æ³•çš„åå°„è°ƒç”¨ï¼\u0026#34;); const className = obj.getClass().getName(); console.log(\u0026#34; |-- çœŸå®ç±»å: \u0026#34; + className); console.log(\u0026#34; |-- æ–¹æ³•ç­¾å: \u0026#34; + this.toString()); console.log(\u0026#34; |-- è°ƒç”¨å †æ ˆ:\u0026#34;); const stackTrace = Java.use(\u0026#34;android.util.Log\u0026#34;).getStackTraceString(Java.use(\u0026#34;java.lang.Throwable\u0026#34;).$new()); console.log(stackTrace); } return this.invoke(obj, args); }; }); } å®šä½åˆ°äº†æ˜¯å¦‚ä¸‹å‡½æ•°\n1 public static java.lang.String com.vip.vcsp.KeyInfo.gs(android.content.Context,java.util.Map,java.lang.String,boolean) ç»§ç»­å¾€ä¸‹çœ‹å‘ç°æ˜¯nativeçš„å‡½æ•°\nå¯¹è¯¥å‡½æ•°hookéªŒè¯ç¡®å®šæ˜¯è¯¥å¹²å‡½æ•°\næœ€ç»ˆåœ¨javaå±‚å®šä½åˆ°jniå‡½æ•° soæ–‡ä»¶ä¸ºKeyinfoï¼Œ metho_name = gsNav\njniå‡½æ•°çš„å„ä¸ªå‚æ•° a3å’Œa4 å›ºå®š 1 2 3 private static native String gsNav(Context context, Map\u0026lt;String, String\u0026gt; map, String str, boolean z10); å¤šæ¬¡æ‰§è¡Œstr= â€œ425d8d985da3022ce5fd670765b30257â€ å›ºå®š flase\tå›ºå®š nativeå±‚ soï¼šlibKeyinfo.so\nmethod: gsNav\noffset: 0xf1edc\nä½¿ç”¨artmethodçš„ç‰¹å¾dataå­—æ®µæ¥å®šä½åç§»ï¼ˆå¥½å§å…¶å®ä¸ç”¨ï¼Œå®ƒæ˜¯é™æ€æ³¨å†Œçš„ï¼‰\ngetByteHashå‡½æ•°çš„ä½œç”¨æ˜¯ï¼šè®¡ç®—ç»™å®ša3æ•°æ®ç¼“å†²åŒºçš„ SHA1 å“ˆå¸Œå€¼ï¼Œå¹¶å°†ç»“æœæ ¼å¼åŒ–ä¸ºä¸€ä¸ª40ä¸ªå­—ç¬¦çš„å°å†™åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚\nå³è®¡ç®—a3çš„hashå€¼ï¼ˆä½¿ç”¨SHA1ï¼‰\nåˆ†æå„ä¸ªå‚æ•° 1 _result = (const char *)getByteHash(a1, a2, v73, v58, \u0026amp;v89, 256LL); ã€v73ã€‘å¾…å“ˆå¸Œçš„æ•°æ® v73 = â€œaee4c425dbb2288b80c71347cc37d04b â€ + javaå±‚ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°str + å‰é¢ä¸¤ä¸ªæ•°æ®ä»¥å›ºå®šæ–¹å¼æ‹¼æ¥mapä¸­çš„æ•°æ®çš„hashå€¼ ç”± src + v57\nsrc Utils_gsigds ï¼šå°†æœ‰åƒåœ¾æ•°æ®çš„å­—ç¬¦ä¸²ä¿®æ­£\nsrc = aee4c425dbb2288b80c71347cc37d04b + javaå±‚ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°str\nv57 1 ByteHash = getByteHash(a1, a2, v19, (unsigned int)v17, \u0026amp;v89, 256LL); v57æ˜¯v19ï¼ˆ_srcï¼‰çš„hashå€¼\nv17æ˜¯v19çš„é•¿åº¦ï¼Œv89æ˜¯è¾“å‡ºç¼“å†²åŒº\nè¿™æ®µä»£ç çš„æ„æ€æ˜¯ å°†mapä¸­çš„æ•°æ®æå–å‡ºæ¥æ‹¼æ¥æˆurlä¸­çš„å½¢å¼\nv19çš„å€¼å¦‚ä¸‹\nå°†ä¸Šé¢çš„src + é”®å€¼å¯¹çš„key + \u0026ldquo;=\u0026rdquo; + é”®å€¼å¯¹çš„value + â€œ\u0026amp;â€ + \u0026hellip;\u0026hellip;\nhookè¿™ä¸ª getByteHash\næœ€åv73å°±æ˜¯ _srcçš„å“ˆå¸Œæ˜¯ï¼ˆä½¿ç”¨SHA1è®¡ç®—ï¼‰\nå› æ­¤æ˜¯åŸå§‹çš„SHA1ç®—æ³•\nã€v58ã€‘å¾…å“ˆå¸Œæ•°æ®çš„é•¿åº¦ åŒç†ï¼Œv58æ˜¯v73çš„é•¿åº¦\nå°†v73çš„å€¼hash å¾—åˆ°æœ€åçš„api _sign pythonçˆ¬è™«è¿˜åŸ authorizationç®—æ³•éƒ¨åˆ†çš„ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 import hashlib def getByteHash(originData): sha1_obj = hashlib.sha1() sha1_obj.update(originData.encode(\u0026#34;utf-8\u0026#34;)) return sha1_obj.hexdigest() def get_api_sign(post_data): str = \u0026#34;aee4c425dbb2288b80c71347cc37d04b\u0026amp;425d8d985da3022ce5fd670765b30257\u0026#34; str1 = str api_sign = \u0026#34;\u0026#34; flag = True #ç¬¬ä¸€ä¸ªå­—å…¸ä¸æ·»åŠ \u0026#34;\u0026amp;\u0026#34; #åŸå§‹å‚æ•°_1å‡†å¤‡ for key, value in post_data.items(): #æ ¹æ®é€†å‘çš„ç»“æœæ„é€ ï¼Œ = \u0026amp; if flag: tmp = key + \u0026#34;=\u0026#34; + value flag = False else: tmp = \u0026#34;\u0026amp;\u0026#34; + key + \u0026#34;=\u0026#34; + value str1 += tmp tmp2 = getByteHash(str1) #åŸå§‹å‚æ•°_2å‡†å¤‡ str2 = str + tmp2 api_sign = getByteHash(str2) return \u0026#34;OAuth api_sign=\u0026#34; + api_sign def main(): data = otherdata data[\u0026#34;keyword\u0026#34;] = \u0026#34;ä¹¦åŒ…\u0026#34;\t#è‡ªå®šä¹‰ api_sign = get_api_sign(data) headers = unSome_headers headers[\u0026#34;authorization\u0026#34;] = api_sign # å‘é€è¯·æ±‚ url = \u0026#34;https://mapi.appvipshop.com/vips-mobile/rest/shopping/search/product/list/v1\u0026#34; response = requests.post(url, headers=headers, data=data) # è¾“å‡ºå“åº” print(\u0026#34;Status Code:\u0026#34;, response.status_code) print(\u0026#34;Response Body:\u0026#34;, response.text) æˆåŠŸå¤åŸï¼Œå¯è‡ªå®šä¹‰æœç´¢é¡¹è¿›è¡Œçˆ¬è™«ï¼Œå†ç»“åˆæ­£åˆ™è¡¨è¾¾ã€çˆ¬è™«æ¡†æ¶ç­‰ï¼Œå³å¯è·å–å¤šæ¬¾å•†å“çš„ä»·æ ¼ç­‰\næ€»ç»“ authorization = â€œaee4c425dbb2288b80c71347cc37d04b â€ +\u0026quot;\u0026amp;\u0026quot; + \u0026ldquo;425d8d985da3022ce5fd670765b30257\u0026rdquo; + å‰é¢ä¸¤ä¸ªæ•°æ®ä»¥å›ºå®šæ–¹å¼æ‹¼æ¥mapä¸­çš„æ•°æ®çš„hashå€¼\nå³ç¬¬ä¸€æ¬¡å¯¹æ•°æ®å“ˆå¸Œï¼Œç¬¬äºŒæ¬¡å¯¹éƒ¨åˆ†æ•°æ®+å“ˆå¸Œè¿›è¡Œå“ˆå¸Œ\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/vip/","summary":"é€†å‘åçˆ¬å‚æ•°çš„ç”Ÿæˆç­–ç•¥ï¼Œå¹¶è¿˜åŸ","title":"ã€çˆ¬è™«ã€‘å”¯å“ä¼šAPPé€†å‘"},{"content":"ç€æ‰‹è¯¥appé€†å‘åˆ†ææ˜¯å› ä¸ºçœ‹åˆ°wxå…¬ä¼—å·Frida and Soçš„ä¸€ç¯‡æ–‡ç« ï¼Œè¯¥å…¬ä¼—å·æ–‡ç« ä¸€å¦‚æ—¢å¾€çš„è¨€ç®€æ„èµ…ï¼Œå› æ­¤å°è¯•åˆ†ææœ€æ–°ç‰ˆæœ¬å¹¶è¡¥å……ç»†èŠ‚ã€‚ï¼ˆå¦‚ä¾µç«‹åˆ ï¼ï¼‰\nè½¯ä»¶\tSH*IN v13.0.2\nåŒ…å com.z*kko\næŠ“åŒ… å¸ŒéŸ³åçˆ¬çš„å‚æ•°æ ¡éªŒï¼ˆarmortokenã€anti-inã€smdeviceidï¼‰\né’ˆå¯¹armortokenè¿™ä¸ªå‚æ•°\njavaå±‚åˆ†æå‚æ•°æ¥æº å…³é”®è¯æœç´¢å®šä½\nè¿™é‡ŒGDAåˆ†æå‡ºæ¥çš„é€»è¾‘æ˜æ˜¾æœ‰é—®é¢˜ï¼ï¼ˆstr=str1åæ²¡è¿”å›ï¼Œè¿”å›ä¸€ä¸ªexceptionä½ ä»€ä¹ˆæ„æ€ï¼‰\næ¢jadxç»§ç»­åˆ†æ\nä½¿ç”¨frida hookè¿™é‡Œçš„SiArmorProxy.fä¸­çš„strç¡®å®å°±æ˜¯armortokençš„æ¥æº\n1 2 com.shein.armor.a.a å‚æ•°ï¼ˆ12, null) ä½¿ç”¨ArtMethodä¸­dataæ®µï¼Œæ¥å®šä½JNIå‡½æ•°çš„åç§»å’Œåº“\naddress : 0x71e2741cc0 offset: 0x77cc0 module : libsi_armor.so\nnativeå±‚åˆ†æ soæ–‡ä»¶ï¼šlibsi_armor.so\nå‡½æ•°ï¼špublic static native Object a(int i2, Object obj);\nå‚æ•°ï¼ša(12, null);\nèŠ±æŒ‡ä»¤å»é™¤ è¿›å…¥åˆ°JNIæ–¹æ³•åç§»å¤„ï¼Œè§‚å¯Ÿåˆ°æœ‰èŠ±æŒ‡ä»¤\næ±‡ç¼–æŒ‡ä»¤åˆ†æ\nå…¶å®æœ€åè·³è½¬çš„åœ°æ–¹å°±æ˜¯ SUB X0, X0 #8 è¿™æ®µ.textæ®µçš„åœ°å€ + 0x44\nç»§ç»­è·Ÿè¸ªï¼Œè·³è½¬è¿‡å»è¿˜æœ‰è·³è½¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 #é—´æ¥å¤„ç†è·³è½¬åœ°å€çš„å‡½æ•° 1ã€sub_77D4C (makeX0NextAddrAdd8) å°†x0è®¾ä¸ºLR + 8 2ã€sub_77DC8 (makeX0NextAddr) x0 = LR 3ã€sub_77E38\t(_makeX0NextAddr) x0 = LR 4ã€sub_77E88 (åŒ1) x0 = LR + 0x8 ...... è¿™æ˜¯æ ¹æ®ä¸Šé¢çš„JNIå‡½æ•°è·Ÿè¸ªå…ˆæ‰‹åŠ¨æ€»ç»“çš„ï¼Œå¯èƒ½ä¸å®Œå…¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 æ€»ç»“ä¸€ä¸‹è·³è½¬çš„ç±»å‹ï¼ˆæ˜¯å¦ä»¥é—´æ¥å¤„ç†çš„å‡½æ•°åœ°å€æ¥ä½œä¸ºåˆ¤æ–­ä¾æ®æ¯”è¾ƒå¥½ï¼ŸPASSï¼Œå› ä¸ºæœ‰äº›å¾ˆå¤šå†…å®¹ç›¸åŒä½†å‡½æ•°åä¸åŒçš„ï¼‰ 1ã€è·³è½¬åœ°å€ä¸ºSUB X0, X0 #8 è¿™æ®µ.textæ®µçš„åœ°å€ + 0x44 BL sub_77D4C; SUB X0, X0, #8 ;\t00 20 00 D1 ADD X1, X0, #0x44 ; \u0026#39;D\u0026#39; ; 01 10 01 91 BR X1 20 00 1F D6 2ã€è·³è½¬åœ°å€ä¸º ADD X0ï¼ŒX0,#8 çš„åœ°å€ + 0x10 ï¼ˆ0x8 + 0x8ï¼‰ BL sub_77D4C ; ADD X0, X0, #8 ;\t00 20 00 91 BR X0\t00 00 1F D6 3ã€è·³è½¬åœ°å€ä¸º MOV X9, X0 çš„åœ°å€ + 0x60 BL sub_77DC8 ; MOV X9, X0\tE9 03 00 AA ADD X9, X9, #0x60 ; \u0026#39;`\u0026#39; ; 29 81 01 91 BR X9\t20 01 1F D6 4ã€è·³è½¬åœ°å€ä¸º MOV X2, X0 çš„åœ°å€ + 0x34 BL sub_77E38 MOV X2, X0 ;\tE2 03 00 AA ADD X2, X2, #0x34 ; 42 D0 00 91 BR X2\t40 00 1F D6 åªå»é™¤äº†éƒ¨åˆ†ï¼Œæ²¡æœ‰å®Œå…¨å¤åŸ\u0026hellip;\u0026hellip;ä¸è¿‡å·²ç»å¥½çœ‹äº†ä¸€äº›\nunidbgåŠ¨æ€åˆ†æ æ„é€ è°ƒç”¨aå‡½æ•°ï¼Œä¹‹å‰åˆ†æå¿«æ‰‹çš„æ—¶å€™é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œå…¶å®è¿˜æœ‰åˆå§‹åŒ–çš„å‡½æ•°æ²¡æœ‰è°ƒç”¨\nå›è¿‡å¤´çœ‹javaå±‚ç¡®å®éœ€è¦è°ƒç”¨initNativeè¿™ä¸ªJNIå‡½æ•°\næ¼«é•¿çš„è¡¥ç¯å¢ƒç¯èŠ‚ã€‚ã€‚ã€‚åˆ©ç”¨fridaå»è·å¾—ä¸€äº›è¡¥ç¯å¢ƒçš„å‚æ•°\nï¼ˆåœ¨åˆ†æjavaå±‚çš„æ—¶å€™è¿˜æ˜¯ç»“åˆå¤šä¸ªåç¼–è¯‘å·¥å…·ä¸€èµ·çœ‹å§ï¼‰\néƒ¨åˆ†è¡¥ç¯å¢ƒçš„è®°å½• è¿™é‡Œcom.shein.armor.a.b-\u0026gt;b.overload(\u0026lsquo;int\u0026rsquo;, \u0026ldquo;java.lang.Object\u0026rdquo;)æ–¹æ³•ä»¥fridaè·å¾—çš„ç»“æœè¡¥å……\nå¤ªå¥½äº†æ²¡å¤šå°‘ç¯å¢ƒè¦è¡¥ï¼ŒæˆåŠŸæ¨¡æ‹Ÿå‡ºaå‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯armortokenå‚æ•°çš„å€¼\n1 2 3 4 5 6 7 8 #armortoken é•¿åº¦0xD7 S2_3.3.5_Mv5PMqZ_w1zWL3VJfh7u-gwZRe_pO2RPE7C8JADr6EkDQR-iIzEEoqUdBgopOSWFkmorVqkVsuDzI81g26-G3lYExP6Sjmk8OyKbC7xVBJsUaa8WAZujzwBHDko-J_OtQ_PLc0XMuykK0896NckPX4VLjaEYumZ9BogyGhRW-zAosnFMUsq6SXsf6mFIDVEr_1752294024718 #å‚æ•°æ„æˆ å›ºå®šæ ‡è¯† SDKç‰ˆæœ¬ åŠ å¯†å­—æ®µ æ—¶é—´æˆ³ å…·ä½“åˆ†æ æ ¹æ®unidbgè¾“å‡ºæ—¥å¿—JNIEnv-\u0026gt;NewStringUTF was called from RX@0x120804d4[libsi_armor.so]0x794d4\nå®šä½åˆ°0x794d4\nåœ¨æ­¤å¤„ä¸‹æ–­ç‚¹ï¼Œç¡®å®å°±æ˜¯è¿™ä¸ª\nè€æ–¹æ³•trace write 0x122dc1c0ï¼Œå¼€å¯æº¯æºæ¨¡å¼ï¼Œå®šä½åˆ°0x4993cï¼Œæ˜¯memcpyå‡½æ•°\nä»tracelogä¸­æ‰¾åˆ°æºæ•°æ®æ¥æºäº0x122dc0e0\nè¿˜æ˜¯ä»0x4993cçš„memcpyå»åˆ†æï¼Œï¼ˆåœ¨sub_49350ä¸­ï¼‰\nåœ¨0x49840çš„å‰åä¸‹æ–­ç‚¹ï¼ŒæŸ¥çœ‹mx0çš„å€¼ï¼Œå¯ä»¥ç¡®å®šå†™å…¥ç‚¹å°±åœ¨è¿™ï¼Œå°†v57 + æ—¶é—´æˆ³æ‹¼æ¥å†™å…¥ç›®æ ‡åœ°å€\næ ¹æ®å‰é¢çš„åˆ†ææ€»ä½“ä¸ºï¼ˆå›ºå®šæ ‡è¯†ï¼ŒSDKç‰ˆæœ¬ï¼ŒåŠ å¯†å­—æ®µï¼Œæ—¶é—´æˆ³ï¼‰ï¼Œç°åœ¨ç§°ï¼ˆå›ºå®šæ ‡è¯†ï¼ŒSDKç‰ˆæœ¬ï¼ŒåŠ å¯†å­—æ®µï¼‰ä¸ºå‰ç¼€\næ‰€ä»¥æ„æˆä¸º å‰ç¼€ + æ—¶é—´æˆ³\nå‰ç¼€ æ ¹æ®tracelogå¯ä»¥ç¡®å®šæ˜¯çœŸæ¡ä»¶ä¸‹çš„å€¼ï¼Œè¿™é‡Œæ˜¯è·å–otherdataçš„åœ°å€ï¼Œtrace 0x122dc2a0 æ‰¾åˆ°å†™å…¥ç‚¹\n0x49468\nåœ¨è¯¥vsnprintå¤„ä¸‹æ–­ç‚¹\n1 2 v43 = 0xca é•¿åº¦æ­£ç¡®âœ” æ„é€ _ohterdata = \u0026#34;S\u0026#34; + \u0026#34;2\u0026#34; + a13 + v46 å›ºå®šæ ‡è¯† â€œSâ€ + \u0026ldquo;2\u0026rdquo;\nsdkç‰ˆæœ¬ a13 0xe4fff449\n1 [18:05:56 245] Memory WRITE at 0xe4fff449, data size = 4, data value = 0x2e332e33, PC=RX@0x1204f9cc[libsi_armor.so]0x489cc, LR=RX@0x1204f520[libsi_armor.so]0x48520 æ ¹æ®tracewriteå®šä½åˆ°å†™å…¥ç‚¹ï¼ˆsub_486F4\u0026mdash;\u0026mdash;0x489ccï¼‰\nåŠ å¯†å­—æ®µ 0x122dc0e0 ï¼Œé•¿åº¦ä¸º0xb0\nå®šä½åˆ°0x2ec98 æ˜¯memoveå‡½æ•°\nmemoveæ˜¯ä»0x122dc1c0èµ‹å€¼çš„æ•°æ®ï¼Œ\nè§‚å¯Ÿåˆ°å…ˆåœ¨0x2ea28è°ƒç”¨å¤„èµ‹å€¼ï¼Œå†0x2ebd8å¤„è¦†ç›–2f\u0026mdash;\u0026gt;5f; 2b\u0026mdash;\u0026gt;2d\n0x122dc1c0å®šä½åˆ°0x2EA24å¤„æ˜¯memcpyï¼Œåœ¨sub_3C8FCå‰åæ–­ç‚¹ï¼Œå¯ä»¥å‘ç°ï¼ŒåŠ å¯†æ•°æ®å°±æ˜¯åœ¨sub_3C8FCä¸­ç”Ÿæˆçš„\n[sub_3C8FC]Base64 ä¸€å…±ä¸¤æ¬¡è°ƒç”¨è¯¥å‡½æ•°\n**summaryï¼š**0x90æ˜¯å¾…base64ç¼–ç çš„æ•°æ®é•¿åº¦ï¼Œa4å‚æ•°æ˜¯å¾…ç¼–ç æ•°æ®\n1 2 3 4 sub_3C8FC(__encryptData, v11, size, v17, v18); 1ã€ï¼ˆ0ï¼Œ0ï¼Œ sizeçš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆ ï¼Œ0x90ï¼‰ æ ¹æ®0x90æ˜¯å¦ä¸º3çš„å€æ•°ï¼Œè¿›è¡Œsize = (4 * (0x90 / 3)) | 1; 2ã€ï¼ˆ0x122dc0e0ï¼ˆæŒ‡é’ˆï¼‰ï¼Œ 0xC1ï¼Œ sizeæŒ‡é’ˆï¼ŒæŒ‡é’ˆï¼ˆåŸå§‹æ•°æ®ï¼‰ï¼Œ0x90) base64ç¼–ç \n1 2 3 4 #ç‰¹å¾ æ¯æ¬¡å¾ªç¯è¯»å–ä¸‰å­—èŠ‚ï¼Œå†™å…¥å››å­—èŠ‚ ä½¿ç”¨å³ç§» \u0026gt;\u0026gt;ã€ä¸ \u0026amp;ã€æˆ– | æ¥ç»„åˆ 6-bit çš„å€¼ æ‰€æœ‰ä½è¿ç®—ç»“æœéƒ½è¢«å½“ä½œç´¢å¼•æŸ¥ä¸€ä¸ªæ•°ç»„ å°†è¾“å…¥æ•°ç»„ a4 ä¸­çš„å†…å®¹æŒ‰ 3 å­—èŠ‚ä¸€ç»„ï¼Œç¼–ç æˆ 4 å­—èŠ‚çš„ Base64 å­—ç¬¦ï¼Œå†™å…¥ _reulst_ptrã€‚\n1 2 base64å­—ç¬¦è¡¨ byte_19188 = \u0026#39;a-z\u0026#39;,\u0026#39;A-Z\u0026#39;,0-9,+, \u0026#34;/\u0026#34; éªŒè¯æ˜¯æ ‡å‡†çš„base64ç¼–ç \næ‰€ä»¥sub_3C8FCçš„a4å°±æ˜¯base64å‰çš„æ•°æ®ï¼Œ0x122eb0a0ï¼Œ é•¿åº¦0x90\n1 2 3 4 5 6 7 8 9 0000: 32 FE 4F 32 A6 7F C3 5C D6 2F 75 49 7E 1E EE FA 2.O2...\\./uI~... 0010: 0C 19 45 EF E9 3B 64 4F 13 B0 BC 24 00 EB E8 49 ..E..;dO...$...I 0020: 03 41 1F A2 23 31 04 A2 A5 1D 06 0A 29 39 25 85 .A..#1......)9%. 0030: 92 6A 2B 56 A9 15 B2 E0 F3 23 CD 60 DB AF 86 DE .j+V.....#.`.... 0040: 56 04 C4 FE 92 8E 69 3C 3B 22 9B 0B BC 55 04 9B V.....i\u0026lt;;\u0026#34;...U.. 0050: 14 69 AF 16 01 9B A3 CF 00 47 0E 4A 3E 27 F3 AD .i.......G.J\u0026gt;\u0026#39;.. 0060: 3F CB F6 EC 3D 41 AC 71 49 5E 6E E5 AA 31 BE 41 ?...=A.qI^n..1.A 0070: 71 72 60 B2 9F 72 44 AF 6A FD 8F BF 0A B4 62 47 qr`..rD.j.....bG 0080: A8 13 51 98 86 4F 0B EB AD 2E ED 84 CF 81 51 2B ..Q..O........Q+ 0x2e8ec\n[sub_39a40] è·³è½¬åˆ°0x398D8\n1 2 __int64 __fastcall sub_398D8(_BYTE *a1, __int64 a2, _OWORD *a3, unsigned int a4) a2ï¼Œa3ä¸º0x122eb0a0å¾…base64åŠ å¯†æ•°æ®çš„æŒ‡é’ˆ a2=a3=2+sdkç‰ˆæœ¬+jniç¯å¢ƒä¸­çš„å€¼com/shein/armor/a/b-b + android/os/Build-\u0026gt;BRAND + android/os/Build-\u0026gt;MODEL + æ—¶é—´æˆ³+ï¼Ÿï¼Ÿï¼Ÿï¼ˆè¿™é‡Œçš„691724686ï¼‰+ ï¼Ÿï¼Ÿï¼Ÿï¼ˆc7cd4bï¼‰ ä¸”æ¯ä¸ªä¹‹é—´ä»¥^@æ‹¼æ¥\næœ€åä»¥PKCS7å¡«å……\nâ€‹\tæ˜¯æŸç§åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œç»§ç»­åˆ†æ\ndowhile å¾ªç¯0x9æ¬¡\næ¯æ¬¡å¤„ç†a2ä¸­çš„ï¼ˆ a2 ~ a2 +7+8ï¼‰16ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæ¯æ¬¡å¾ªç¯ç»“æŸåa2 + 16\n1 2 3 4 5 6 7 8 9 10 9x122eb0a0 ~ 0x122eb0af ...... 0x122eb0a0 ~ 0x122eb120 a1[488] = a1[488] ^ a2 a1[489] = a1[489] ^ (a2 + 1) a1[490] = a1[490] ^ (a2 + 2) ...... a1[503] = a1[503] ^ (a2 + 15) å†è¿›å…¥ sub_3984C å‡½æ•°ï¼Œå°†ç»“æœä½ç½®çš„v7å­˜åœ¨a3ä¸­\na1[488~503] æ˜¯è¿­ä»£çŠ¶æ€\næ ¹æ®tracelogå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„v7ä¹Ÿæ˜¯16å­—èŠ‚ï¼Œa2å’Œa3ä¸€å¼€å§‹æ˜¯ç›¸åŒæŒ‡é’ˆåœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œv9åç»­å–çš„ä¹Ÿå°±æ˜¯sub_3984Cå¤„ç†åçš„æ•°æ®\næ‰€ä»¥æ›´åŠ æ¨æ–­æ˜¯AESçš„CBCæ¨¡å¼ï¼Œæ¥ä¸‹å»å»è·å–ivå’Œkey\n[sub_3984C] æ ¸å¿ƒ æ ¹æ®è¿™å‡ ä¸ªè¡¨ç´¢å¼•æŸ¥åˆ°å…¶å®æ˜¯TEè¡¨1-4ï¼Œç”¨äºæŸ¥æ‰¾è¡¨ä¼˜åŒ–\ntrace sub_394F4è¿”å›å‰ 0xe4fff2d0Lçš„å†…å­˜ï¼Œå°±æ˜¯æœ€åçš„å¯†æ–‡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ======================sub_394F4================================= 0000: 32 5E 40 5E 33 2E 33 2E 35 5E 40 5E 31 64 30 35 2^@^3.3.5^@^1d05 ======================sub_394F4================================= 0000: 57 9A 78 0A C5 4E A6 6C E7 1C 41 2D 4B 7A D6 CF W.x..N.l..A-Kz.. ======================sub_394F4================================= 0000: 39 2F 76 DF D1 0E 56 79 24 88 DA 40 39 8D DC 2A 9/v...Vy$..@9..* ======================sub_394F4================================= 0000: 65 79 7A C0 16 09 62 90 9C 24 67 68 4A 0E 16 BC eyz...b..$ghJ... ======================sub_394F4================================= 0000: F3 5F 18 63 9F 74 D7 84 CB 47 FE 02 85 EF D8 B9 ._.c.t...G...... ======================sub_394F4================================= 0000: 39 6B A3 92 F7 D0 29 62 75 47 E3 7E CF 75 32 CB 9k....)buG.~.u2. ======================sub_394F4================================= 0000: 4A 29 F1 27 36 AE 91 FC 38 7E 37 78 0B 17 C0 99 J).\u0026#39;6...8~7x.... ======================sub_394F4================================= 0000: BE 7C 1E 43 FC 8E 02 81 05 6D DA C1 A3 C1 E8 D2 .|.C.....m...... ======================sub_394F4================================= 0000: 37 96 2C EC E2 89 2D 56 DD D5 6A 83 11 99 33 76 7.,...-V..j...3v è¾“å…¥å‰ è¾“å…¥åsub_394F4\nåœ¨0x398D8æ–­ç‚¹ï¼Œ\nå› ä¸ºa1[488..503]ï¼šè¢«ä¸æ–­ xor æ“ä½œï¼Œç»“åˆå‰é¢çš„åˆ†æï¼Œå¯ä»¥ç¡®å®šæ˜¯ CBC çš„IV = 0000000000000000\nåœ¨9æ¬¡å¾ªç¯ä¸‹æ–­ç‚¹ï¼Œæ¯æ¬¡çš„a1 + 488 ç¬¬ä¸€æ¬¡å…¨0ï¼Œåç»­éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ç»“æœï¼Œç¬¦åˆaesCBC\nç¬¬ä¸€è½®çš„æ‰æ˜¯åˆå§‹iv\nè¿™å‡ è¡Œè¡¨ç¤ºç”¨ a1 åœ°å€å¤„çš„å‰ 16 å­—èŠ‚ï¼ˆå³ a1 + 0 åˆ° a1 + 16ï¼‰åˆ†åˆ«å’Œä¼ å…¥æ˜æ–‡å—ï¼ˆå¤§ç«¯è½¬å°ç«¯åï¼‰åš XORã€‚\nï¼ˆa1å…¶å®åŒ…æ‹¬äº† keyã€ivã€è½®å¯†é’¥è¿™äº›æ•°æ®ï¼‰\nå¯†é’¥Gibw1p_aX\u0026amp;!0o+_G\tä¸€å¼€å§‹ä»¥ä¸ºæ˜¯è¿™ä¸ªå¡ä½äº†\næ¯å››å­—èŠ‚è¯»å–ä½œä¸ºå¯†é’¥ä¸º\nwbiGa_p10!\u0026amp;XG_+o\næˆåŠŸæ¢å¤ï¼Œivå’Œkeyæ­£ç¡®\næ˜æ–‡æ•°æ®çš„æ¥æº 1 2 3 4 5 6 7 8 9 10 11 12 #0x122eb000 0000: 32 5E 40 5E 33 2E 33 2E 35 5E 40 5E 31 64 30 35 2^@^3.3.5^@^1d05 0010: 65 64 37 38 63 31 65 30 31 33 34 64 35 64 38 35 ed78c1e0134d5d85 0020: 35 36 33 30 38 35 32 36 37 38 66 64 39 66 34 63 5630852678fd9f4c 0030: 66 38 65 62 35 38 66 32 39 39 61 62 63 37 33 39 f8eb58f299abc739 0040: 61 35 33 35 36 61 65 64 38 64 33 62 5E 40 5E 67 a5356aed8d3b^@^g 0050: 6F 6F 67 6C 65 5E 40 5E 4E 65 78 75 73 20 36 50 oogle^@^Nexus 6P 0060: 5E 40 5E 31 37 35 32 33 39 34 33 37 31 35 32 30 ^@^1752394371520 0070: 5E 40 5E 34 32 38 30 34 30 33 30 31 5E 40 5E 38 ^@^428040301^@^8 0080: 36 61 34 64 31 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 6a4d1........... 2+sdkç‰ˆæœ¬+jniç¯å¢ƒä¸­çš„å€¼com/shein/armor/a/b-b + android/os/Build-\u0026gt;BRAND + android/os/Build-\u0026gt;MODEL + æ—¶é—´æˆ³+ï¼Ÿï¼Ÿï¼Ÿ1ï¼ˆè¿™é‡Œçš„691724686ï¼‰+ ï¼Ÿï¼Ÿï¼Ÿ2ï¼ˆc7cd4bï¼‰ ä¸”æ¯ä¸ªä¹‹é—´ä»¥^@æ‹¼æ¥ ã€1ã€‘éšæœºæ•°ï¼ˆä»¥æ—¶é—´æˆ³ä¸ºç§å­ç”Ÿæˆï¼‰\n0x48d60æ‰¾åˆ°048D60å¤„çš„memcpy\nå‰©ä¸‹ä¸‰ä¸ªå‚æ•°ç”±æ ˆä¼ é€’\n1 2 %d\t^@^\t%s\t^@^\t%s\t^@^ %s ^@^ %s ^@^ %s ^@^ %d 2 3.3.5\t1d... google Nexus 6P 1752412831975 853602514 æ‹¼æ¥jni environmentä¸­çš„å‚æ•°\nè¿™ä¸ªå‚æ•°å°±æ˜¯ä»¥æ—¶é—´æˆ³ä¸ºç§å­ç”Ÿæˆçš„éšæœºæ•°\nâ€‹\tå­˜å‚¨åœ¨0x122d6100ä¸­\nã€2ã€‘md5[-6:]\nå‰é¢ä¸€å…±0x7C\nè¿™é‡Œæ·»åŠ 0x405e32 \u0026ldquo;^@^\u0026rdquo;\nåœ¨0x83764å¤„çš„memoveå¤„ä¸‹æ–­ç‚¹\nLR=RX@0x120500d8[libsi_armor.so]0x490d8\n0xe4fff3b9 0x838b4 0x122d30aa 0x49014\nåœ¨è¿›å…¥0x838b4 ï¼ˆsub_83814æ—¶ï¼Œ0x122d30aa å°±å·²ç»æœ‰è¯¥å€¼äº† ï¼‰ ï¼Œæ‰€ä»¥å’Œ a2å’Œa3æœ‰å…³\nä¸€å¼€å§‹æ²¡æœ‰traceåˆ°ï¼Œæ˜¯å› ä¸ºç›´æ¥traceäº†0x122d30aa -0x122d30aa +0x6çš„èŒƒå›´ï¼Œæ‰©å¤§èŒƒå›´0x36520\nsub_3639Cå¯¹a1+1çš„åœ°å€è¿›è¡Œhexç¼–ç å¾—åˆ°æœ€åæ®µæ•°æ®\nåœ¨sub_3AD9Cæ–­ç‚¹ï¼Œå¯¹æ¯”å‰å\u0026amp;v18çš„ç»“æœ å› ä¸ºèŠ±æŒ‡ä»¤å–å‡ºä¸å®Œæ•´ï¼Œé‡‡ç”¨å¯¹ç…§traceçš„è·³è½¬åœ°å€\næœ€åè¿›å…¥ sub_3A1E4 ï¼ˆå¤§é‡çš„ä½æ“ä½œ (\u0026amp;, |, ~, \u0026gt;\u0026gt;) å¤§é‡å›ºå®šçš„é­”æ³•æ•°å­— (Magic Numbers)ï¼Œä¾‹å¦‚ -389564586, 606105819, -1044525330, -176418897, 1200080426, -1473231341ï¼‰ï¼Œå°±æ˜¯md5åŠ å¯†\nåœ¨çº¿éªŒè¯ï¼Œæ˜¯æœªé­”æ”¹çš„md5\n2å…¶å®æ˜¯å¯¹å‰é¢çš„æ•°æ®è¿›è¡Œmd5åå–å6ä½\nè¿‡ç¨‹ä¸­å‘ç°å¯†é’¥æ˜¯ç¡¬ç¼–ç \nè¦†ç›– åœ¨0x2ebfcå¤„è¦†ç›–2f\u0026mdash;\u0026gt;5f; 2b\u0026mdash;\u0026gt;2d\næ—¶é—´æˆ³ é€šè¿‡gettimeofdayå‡½æ•°è·å–æ—¶é—´æˆ³åŠ å…¥åˆ°armortokenstrçš„æœ«å°¾\næ€»ç»“ armortoken å‚æ•°ç”Ÿæˆæ–¹å¼ï¼š\nå›ºå®šæ ‡è¯† \u0026quot;S\u0026quot; + \u0026quot;2\u0026quot;\nSDK ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ 3.3.5ï¼‰\nå¯†æ–‡æ•°æ®ï¼š\ncom/shein/armor/a/b-bçš„å€¼ã€è®¾å¤‡å“ç‰Œï¼ˆandroid/os/Build-\u0026gt;BRANDï¼‰ã€è®¾å¤‡å‹å·ï¼ˆandroid/os/Build-\u0026gt;MODELï¼‰\nã€æ—¶é—´æˆ³ã€ä¸€ä¸ªä»¥æ—¶é—´æˆ³ä¸ºç§å­ç”Ÿæˆçš„éšæœºæ•°ã€ç”±å‰é¢æ•°æ®ä»¥åŠ^@^æ„æˆçš„æ•°æ®è¿›è¡Œ MD5 åŠ å¯†åæˆªå–å 6 ä½çš„å€¼ï¼Œå¹¶å¯èƒ½åœ¨æœ«å°¾è¿›è¡Œ PKCS7 å¡«å……ã€‚ æ„æˆæ˜æ–‡æ•°æ®ï¼Œåœ¨ä½¿ç”¨AES-256 åŠ å¯†ç®—æ³•çš„ CBC æ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå°† 2f (ASCII \u0026lsquo;/\u0026rsquo;) æ›¿æ¢ä¸º 5f (ASCII \u0026lsquo;_\u0026rsquo;)ï¼Œå°† 2b (ASCII \u0026lsquo;+\u0026rsquo;) æ›¿æ¢ä¸º 2d (ASCII \u0026lsquo;-\u0026rsquo;)ï¼Œå†è¿›è¡ŒHEXç¼–ç ï¼Œæœ€åè¿›è¡Œbase64ç¼–ç \né¢å¤–çŸ¥è¯†ç‚¹ è¡¥å……ä¸€ä¸‹ä¸€äº›å†…å®¹\nunidbgä¸­callStaticJniMethod å’Œ Module.callFunction æ–¹å¼è°ƒç”¨JNIå‡½æ•°çš„åŒºåˆ«å’Œä¼˜åŠ£\ncallStaticJniMethod é€šè¿‡ JNI å±‚è°ƒç”¨ Java æ–¹æ³•\nâ€‹\té€šè¿‡æ¨¡æ‹Ÿ Java å±‚è°ƒç”¨ JNI æ–¹æ³•ï¼Œæ˜¯é€šè¿‡ DalvikVM æ¥æ¨¡æ‹Ÿ Android Java å±‚ä»£ç æ‰§è¡Œï¼Œéƒ¨ä¼šæ¨¡æ‹Ÿ JNI æ³¨å†Œï¼Œå‚æ•°è½¬æ¢ï¼Œä»¥åŠå›è°ƒ Native å±‚ã€‚\nâ€‹\té€»è¾‘æ€§è¾ƒå®Œæ•´ï¼Œå› ä¸ºæ˜¯æ¨¡æ‹Ÿçš„ä»javaå±‚å»è°ƒç”¨ï¼Œé€‚åˆæ³¨å†Œäº†nativeçš„æ–¹æ³•\nmodule.callFunction ç›´æ¥è°ƒç”¨ native å‡½æ•°åœ°å€\nâ€‹\tç›´æ¥è°ƒç”¨ SO æ–‡ä»¶ä¸­æŸä¸ªå‡½æ•°çš„åœ°å€ï¼Œè·³è¿‡ Java å±‚ã€JNI å°è£…ï¼Œç›´æ¥è¿›å…¥ native å±‚æ‰§è¡Œå‡½æ•°ä»£ç ã€‚\nâ€‹\tç›´æ¥è°ƒç”¨ç‰¹å®šå‡½æ•°ï¼Œå¯ç”¨äºå®šä½ã€åè°ƒè¯•ã€HOOK ç‚¹ã€å†…éƒ¨é€»è¾‘æ‰§è¡Œã€‚\nNumber number = module.callFunction() è¿™ä¸ª number çš„æ„ä¹‰æ˜¯ï¼š\nå¦‚æœ native å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ•´æ•°ï¼ˆå¦‚ int æˆ– jintï¼‰ï¼Œä½ å¯ä»¥ç”¨ number.intValue()\nå¦‚æœå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆå¦‚ jstring æˆ–å…¶ä»– jobjectï¼‰ï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯è¯¥å¯¹è±¡åœ¨è™šæ‹Ÿæœºä¸­çš„ reference ID\nå®‰å“ç³»ç»Ÿé™æ€å¸¸é‡ï¼ˆç”¨äºéƒ¨åˆ†ç¯å¢ƒè¡¥å……ï¼‰\nå­—æ®µ å‘½ä»¤ ç¤ºä¾‹è¿”å› Build.BRAND adb shell getprop ro.product.brand google Build.MODEL adb shell getprop ro.product.model MI 9 Build.MANUFACTURER adb shell getprop ro.product.manufacturer Xiaomi Build.DEVICE adb shell getprop ro.product.device cepheus Build.FINGERPRINT adb shell getprop ro.build.fingerprint Xiaomi/cepheus/cepheus:10/QKQ1... Build.VERSION.SDK_INT adb shell getprop ro.build.version.sdk 30 Build.VERSION.RELEASE adb shell getprop ro.build.version.release 11 å‚è€ƒèµ„æ–™ https://mp.weixin.qq.com/s/nvNCmXXAbstYZUkxDZ9ZnQ\nhttps://www.cnblogs.com/kentle/p/15529251.html\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/shenin/","summary":"æµ·å¤–ç”µå•†APPå¸ŒYæŸçš„armortokenå‚æ•°ç”Ÿæˆç®—æ³•é€†å‘åˆ†æ","title":"æµ·å¤–ç”µå•†APPå¸ŒYæŸå‚æ•°åˆ†æ"},{"content":"\ræ ·æœ¬ï¼šè¶…æ˜Ÿå­¦ä¹ é€š[v6.5.9]\nåŒ…åï¼šcom.chaoxing.mobile\njavaå±‚åˆ†æ æ¢†æ¢†åŠ å›ºç‰¹å¾\nç¨‹åºå…¥å£ç‚¹\næ ¹æ®ç³»ç»Ÿæ¶æ„é€‰æ‹©\nåœ¨load()å‡½æ•°åï¼Œä½¿ç”¨doAttach()åˆ©ç”¨åå°„çš„æ‰‹æ®µè°ƒç”¨ä»£ç ï¼Œé‚£ä¹ˆlibDexHelper.soå³ä¸ºå¯¹åŸå§‹dexæ–‡ä»¶çš„é‡Šæ”¾\nnativeå±‚åˆ†æ soæ–‡ä»¶ï¼šlibDexHelper.so\nç›´æ¥æ‰“å¼€apkä¸­çš„soæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°soæ–‡ä»¶è¢«åŠ å¯†\nè·å–è§£å¯†åçš„soæ–‡ä»¶ dumpè§£å¯†soæ–‡ä»¶çš„æ—¶æœº\nåšæ–‡ç»™å‡ºçš„æ˜¯åœ¨android_dlopen_extæ—¶æœº\ndumpçš„é€»è¾‘æ˜¯ä¿®æ”¹ç›®æ ‡æ®µçš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œå†å°†å†…å­˜è¯»åˆ°ç¼“å†²åŒºï¼Œå†™å…¥ç›®æ ‡åœ°å€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 function hook_dlopen(){ var soName = \u0026#34;libDexHelper.so\u0026#34; Interceptor.attach(Module.findExportByName(null, \u0026#39;android_dlopen_ext\u0026#39;),{ onEnter : function(args){ //arg[0] æ˜¯è¦åŠ è½½çš„soçš„è·¯å¾„ if(args[0] != null){ let loadPath = Memory.readUtf8String(args[0]) console.log(\u0026#34;dlopen call is: \u0026#34; + loadPath + \u0026#34;\\n\u0026#34;) if (loadPath.includes(soName)){ this.flag = 1 } } },onLeave:function(retval){ console.log(\u0026#34;dlopen return\\n\u0026#34;) if (this.flag === 1){ dumpSo(soName) this.flag = 0 } } }) } function dumpSo(filename){ var handle = Process.getModuleByName(filename) console.log(\u0026#34;[dump] start dumping ---------\u0026#34; + handle) var path = \u0026#34;/data/data/com.chaoxing.mobile/\u0026#34; + handle.name + \u0026#34;_\u0026#34; + handle.base + \u0026#34;_\u0026#34; + ptr(handle.size) + \u0026#34;.so\u0026#34; var file_handle = new File(path, \u0026#34;wb\u0026#34;) if(!file_handle){ console.log(\u0026#34;[dump] dump failed\u0026#34;) return } Memory.protect(ptr(handle.base), handle.size, \u0026#39;rwx\u0026#39;) var libbuffer = ptr(handle.base).readByteArray(handle.size) file_handle.webkitRelativePath(libbuffer) file_handle.close() console.log(\u0026#34;[dump] dump finished and path is: \u0026#34; + path) } setImmediate(hook_dlopen) å†…å­˜ä¸­dumpä¸‹æ¥çš„soæ–‡ä»¶éœ€è¦è¿›è¡Œä¿®å¤ï¼Œè¿™é‡Œä½¿ç”¨sofixerä¿®å¤\n1 2 3 4 5 sofixer -s soruce.so -o fix.so -m 0x0 -d -s å¾…ä¿®å¤çš„soè·¯å¾„ -o ä¿®å¤åçš„soè·¯å¾„ -m å…§å­˜dumpçš„åŸºåœ°å€(16ä½) 0xABC -d è¾“å‡ºdebugä¿¡æ¯ ä¿®å¤å\nè¿˜æœ‰ä¸€äº›å‡½æ•°åè¢«æ··æ·†ï¼Œç”¨idapythonæ¢å¤ä¸ºsub_offset\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import idautils import idc def rename_function(): for func_ea in idautils.Functions(): funcName = idc.get_func_name(func_ea) if funcName.startswith(\u0026#34;pS\u0026#34;) or funcName.startswith(\u0026#34;j_\u0026#34;) or funcName.startswith(\u0026#34;p5\u0026#34;): editName = f\u0026#34;sub_{func_ea:X}\u0026#34; else: continue if idc.set_name(func_ea, editName, idc.SN_NOWARN): print(f\u0026#34;[Success] {funcName} ---\u0026gt; {editName} in (0x{func_ea:X})\u0026#34;) rename_function() åˆ†æ JNI_Onloadä¸­\n1 2 3 4 5 6 7 8 9 com/secneo/apkwrapper/H (Ljava/lang/String;)I (Ljava/lang/String;I)V (I)V (Ljava/lang/String;)Ljava/lang/String; d com/secneo/apkwrapper/AW ()V pn (Landroid/content/Context;Landroid/app/Application;)V hn sub_3199Cå‡½æ•°é›†åˆäº†å„ç§æ£€æµ‹\næœ‰å¾ˆå¤šè·³æ¿å‡½æ•°ï¼Œéœ€è¦ç»“åˆ0x71aeb83000å†…å­˜åŠ è½½åœ°å€å»è·³è½¬\n0x430C0å®ç°å¯¹ libc.so ä¸­ readã€open64ã€openat64ç­‰\tå‡½æ•°çš„ hook æˆ–æ›¿æ¢ã€‚\nsub_52BC4ä¸­\nlibcç¬¦å·è¡¨æ¢å¤ ä¸€äº›thunkå‡½æ•°0x7254D05110å…¶å®æ˜¯libcä¸­çš„\nbase = 0x7254c9a000\nå¯¼å‡ºlibcç¬¦å·è¡¨ 1 nm -D libc.so \u0026gt; libc_symbols.txt å¯¼å…¥åˆ°libdexhelpä¸­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import idautils import ida_bytes import idc libc_base = 0x7254c9a000 # /proc/pid/maps/ è·å¾— libc_symbols = {} with open(\u0026#39;./libc_symbols.txt\u0026#39;, \u0026#39;r\u0026#39;) as f: for line in f: parts = line.strip().split() if len(parts) \u0026gt;= 3: offset = int(parts[0], 16) name = parts[2].split(\u0026#39;@@\u0026#39;)[0] # å»æ‰ç‰ˆæœ¬å· libc_symbols[libc_base + offset] = name # éå†å½“å‰æ®µä¸­çš„ qword for ea in idautils.Segments(): segname = idc.get_segm_name(ea) if \u0026#39;.data\u0026#39; in segname or \u0026#39;.got\u0026#39; in segname: start = idc.get_segm_start(ea) end = idc.get_segm_end(ea) for addr in range(start, end, 8): # 64ä½ç³»ç»Ÿ if idc.is_qword(ida_bytes.get_full_flags(addr)): ptr_val = idc.get_qword(addr) if ptr_val in libc_symbols: name = f\u0026#34;{libc_symbols[ptr_val]}_ptr\u0026#34; idc.set_name(addr, name, idc.SN_CHECK) print(f\u0026#34;[success] edit the {addr} ---\u0026gt; {name}\u0026#34;) ã€sub_52BC4ã€‘æ£€æµ‹frida 1 2 3 4 5 6 7 //libcéƒ¨åˆ†å‡½æ•°çš„å‚æ•°åŠç”¨æ³• sendtoï¼ˆint sockfdï¼Œ const void *msgï¼Œint len , unsigned int flagsï¼Œ const struct sockaddr *toï¼Œ int tolenï¼‰ // recvfromï¼ˆint sockfdï¼Œvoid *bufï¼Œint lenï¼Œunsigned int lagsï¼Œstruct sockaddr *fromï¼Œint *fromlen // access(const char* pathname, int mode) //æ£€æŸ¥è°ƒç”¨è¿›ç¨‹æ˜¯å¦èƒ½å¯¹pathnameæŒ‡å®šçš„æ–‡ä»¶ä½œmodeæ“ä½œï¼ŒæˆåŠŸæ‰§è¡Œè¿”å›0ï¼Œå¤±è´¥ä¸º-1 1 2 3 4 5 6 7 8 qword_EDE40 = GET/ws HTTP/1.1 Upgrade: websocket Connection: Upgrade Sec-WebSocket-Key: nmmA32Q10Aqj2vWK w== Sec-WebSocket-Version: 13 Host: 127.0.0.1:27042 1 2 3 4 5 v16[0] = 2; //è¿™ä¸ªèµ‹å€¼æ“ä½œçœ‹èµ·æ¥åƒæ˜¯è®¾ç½®æŸä¸ªåè®®æ—ï¼ˆfamilyï¼‰ã€‚ åœ¨å¸¸è§çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒAF_INET çš„å€¼æ˜¯ 2ï¼Œè¡¨ç¤º IPv4 åœ°å€æ—ã€‚å› æ­¤ï¼Œè¿™å¯èƒ½æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ª sockaddr_in ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µ sin_familyã€‚ v4 = 20000; è¿™ä¸ªå˜é‡ v4 è¢«è®¾ç½®ä¸º 20000ã€‚è€ƒè™‘åˆ°åç»­çš„æ“ä½œï¼Œè¿™ä¸ªå€¼å¾ˆå¯èƒ½æ˜¯ç”¨äºè®¾ç½®ç«¯å£å·ã€‚ v16[1] = bswap32(v4) \u0026gt;\u0026gt; 16; è¿™é‡Œå¯¹ v4 è¿›è¡Œäº†å­—èŠ‚äº¤æ¢ (bswap32) å¹¶å³ç§» 16 ä½ã€‚å­—èŠ‚äº¤æ¢é€šå¸¸ç”¨äºå¤„ç†ä¸åŒå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œä»ä¸»æœºå­—èŠ‚åºåˆ°ç½‘ç»œå­—èŠ‚åºï¼‰ã€‚å‡è®¾ bswap32(v4) å°† v4 çš„å­—èŠ‚é¡ºåºåè½¬ï¼Œå¯¹äºå€¼ 20000ï¼ˆå³åå…­è¿›åˆ¶çš„ 0x4E20ï¼‰ï¼Œå…¶å­—èŠ‚äº¤æ¢åçš„ç»“æœä»ç„¶æ˜¯ 0x4E20ï¼ˆå› ä¸ºå®ƒæ˜¯32ä½æ•´æ•°ï¼Œä¸”é«˜ä½å­—èŠ‚ä¸ºé›¶ï¼‰ã€‚ç„¶åå°†å…¶å³ç§»16ä½ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ 0x0000ã€‚ æ ¹æ®27042ç«¯å£ï¼Œå³ æœ¬åœ°çš„ Frida Server é»˜è®¤ç›‘å¬ç«¯å£\n1 2 3 4 è¿™æ®µä»£ç çš„è¡Œä¸º ç”¨ AUTH\\r\\n æ¢æµ‹æœåŠ¡æ˜¯å¦å¼€å¯ å‘é€æ ‡å‡† WebSocket è¯·æ±‚åˆ° 127.0.0.1:27042ï¼Œåˆ†ææ˜¯å¦è¿”å› Sec-WebSocket-Acceptï¼Œåˆ¤æ–­ WebSocket æ˜¯å¦è¢«æ¥å— å¦‚æœæˆåŠŸï¼Œè¯´æ˜æœ¬åœ° Frida æ­£åœ¨è¿è¡Œï¼Œè¢«è¯†åˆ« ã€sub_4CB6Cã€‘ç¯å¢ƒæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 xmmword_C4200 = [-2, -3, -1, -2, -3, -1, -2, -3, -1, -2, -3, -1, -2, -3, -1, -2] def v37_a(old, num): print(chr(ord(old) -num)) def common(oldstr): tmp = \u0026#34;\u0026#34; tmp2 = \u0026#34;\u0026#34; tmp += oldstr[0] if (len(oldstr) \u0026gt; 16): tmp2 = oldstr[17::] for i in range(16): tmp += chr(ord(oldstr[i + 1]) + xmmword_C4200[i]) if (len(oldstr) \u0026gt; 16): tmp += tmp2 return tmp def v37_1(): v37 = \u0026#34;0uejp2/ersg2ed011pbiltm1ed\u0026#34; a0uejp2Ersg2ed0 = \u0026#34;0uejp2/ersg2ed011pbiltm1ed\u0026#34; # a(a0uejp2Ersg2ed0[17], 3) # a(a0uejp2Ersg2ed0[18] ,1) # a(a0uejp2Ersg2ed0[19] , 2) # a(a0uejp2Ersg2ed0[20] , 3) # a(a0uejp2Ersg2ed0[21] , 1) # a(a0uejp2Ersg2ed0[22] , 2) # a(a0uejp2Ersg2ed0[23] , 3) # a(a0uejp2Ersg2ed0[24] , 1) # a(a0uejp2Ersg2ed0[25] , 2) v37 = \u0026#34;/uejp2/ersg2ed011magisk.db\u0026#34; v37 = common(v37) return v37 def v45_1(): v45 = \u0026#34;0uejp2/ersg2nkusqr\u0026#34; v45 = \u0026#34;/uejp2/ersg2nkusqr\u0026#34; v45 = common(v45) return v45 def v50_1(): v50 = \u0026#34;0u|tvhn1ejp2ncjjuk\u0026#34; v50 = \u0026#34;/u|tvhn1ejp2ncjjuk\u0026#34; v50 = common(v50) return v50 print(\u0026#34;v37 === \u0026#34;,v37_1()) print(\u0026#34;v45 === \u0026#34;,v45_1()) print(\u0026#34;v50 === \u0026#34;,v50_1()) 1 2 3 4 5 6 /sbin/.core/db-0/magisk.db .coreæ˜¯ä½¿ç”¨çš„éšè—ç›®å½•ï¼ŒåŒ…å«å…¶æ ¸å¿ƒè¿è¡Œæ—¶æ•°æ®ã€‚æ•°æ®åº“å­˜å‚¨è®¾ç½®å’Œrootæƒé™ /sbin/.core/mirror\tæ˜¯ Magisk çš„ä¸€ä¸ªå…³é”®åŠŸèƒ½ â€”â€” system-as-root é•œåƒæŒ‚è½½ç‚¹\t/system/bin/magisk\tæ˜¯ä¸»ç¨‹åº /system/usr/we-need-root/ /system/bin/failsafe/ é€šè¿‡ä¸€äº›å­—ç¬¦ä¸²çš„æ‹¼æ¥è§£å¯†è·å¾—æ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨accesså‡½æ•°åˆ¤æ–­\n1ã€/sbin/.core/mirror\n2ã€/data/local/su\n3ã€/data/local/bin/su\n4ã€ /data/local/xbin/su\n5ã€/sbin/su\n6ã€/su/bin/su\n7ã€/system/bin/su\n8ã€/system/bin/.ext/su\n9ã€/system/bin/failsafe/su\n10ã€/system/sd/xbin/su\n11ã€/system/usr/we-need-root/su\n12ã€/system/xbin/su\nè°ƒç”¨ openat ä¸­æ–­è®¿é—®/proc/self/attr/prevæ–‡ä»¶è·å–æ•°å€¼ä¸å­—ç¬¦ä¸²u:r:zygote:s0æ¯”å¯¹è°ƒç”¨\nSELinux ä¸Šä¸‹æ–‡ï¼ˆSELinux Contextï¼‰æ£€æµ‹ï¼Œç”¨äºåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦è¿è¡Œåœ¨é¢„æœŸçš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­\n1 2 3 4 5 6 7 8 user:role:type:sensitivity u:r:zygote:s0 â†’ zygote è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡ /proc/self/attr/prev æ˜¯ä»€ä¹ˆï¼Ÿ è¿™æ˜¯ SELinux æä¾›çš„ä¸€ä¸ªæ¥å£æ–‡ä»¶ï¼Œè¡¨ç¤º å½“å‰è¿›ç¨‹çš„ä¸Šä¸€ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒApp æ˜¯ç”± Zygote å¯åŠ¨çš„ï¼Œå®ƒçš„ prev ä¸Šä¸‹æ–‡æ˜¯ u:r:zygote:s0 å¦‚æœä¿®æ”¹äº†å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡ su ææƒåå†å¯åŠ¨è¿™ä¸ª Appï¼Œé‚£ä¹ˆ prev ä¸Šä¸‹æ–‡å°±ä¼šå˜æˆ u:r:su:s0 æˆ–å…¶ä»–é zygote ä¸Šä¸‹æ–‡ ro.build.tags ä¸»è¦ç”¨äºæ ‡è¯†æ„å»ºç±»å‹å¦‚æœæ£€æµ‹åˆ° test-keys è€Œä¸æ˜¯ release-keysï¼Œåˆ™å¯èƒ½æç¤ºç”¨æˆ·å½“å‰ç³»ç»Ÿå­˜åœ¨æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚\nã€sub_52EA0ã€‘javaå±‚æ£€æµ‹ 1 2 3 4 5 int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg); //\\3) void *(*start_routine) (void *)ï¼šä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æŒ‡æ˜æ–°å»ºçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°æœ€å¤šæœ‰ 1 ä¸ªï¼ˆå¯ä»¥çœç•¥ä¸å†™ï¼‰ï¼Œå½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹éƒ½å¿…é¡»ä¸º void* ç±»å‹ã€‚void* ç±»å‹åˆç§°ç©ºæŒ‡é’ˆç±»å‹ï¼Œè¡¨æ˜æŒ‡é’ˆæ‰€æŒ‡æ•°æ®çš„ç±»å‹æ˜¯æœªçŸ¥çš„ã€‚ä½¿ç”¨æ­¤ç±»å‹æŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å…ˆå¯¹å…¶è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç„¶åæ‰èƒ½æ­£å¸¸è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ã€‚ æ ¹æ®pthread_createå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•å¾—x2å¯„å­˜å™¨å­˜æ”¾çš„sub_52EA0å‡½æ•°ï¼Œå…¶å®æ˜¯å°†è¦å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°åœ°å€\nçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œsub_52EA0\nè¿™è¾¹éœ€è¦æ ¹æ®æ±‡ç¼–æ‰‹åŠ¨æ¢å¤è¯¥å‡½æ•°çš„ç­¾åï¼ˆå› ä¸ºæ˜¯thunkè·³æ¿å‡½æ•°æ‰€ä»¥idaæ²¡æœ‰è‡ªåŠ¨è¯†åˆ«ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨idapythonå»åšè‡ªåŠ¨åŒ–æ‰¹é‡è®¾ç½®\n1 j_execl_ptr(\u0026#34;/system/bin/app_process\u0026#34;, \u0026#34;/system/bin/app_process\u0026#34;, \u0026#34;/system/bin\u0026#34;, â€œ--nice-name=zygisk.soâ€, \u0026#34;com.secneo.apkwrapper.H\u0026#34;, \u0026#34;--write-fd\u0026#34;, v12, \u0026#34;--flags\u0026#34;, 0, 0LL); soå±‚é€šè¿‡excelå¯¹javaå±‚è¿›è¡Œæ£€æµ‹ï¼Œæ£€æµ‹tracepid\nâ€‹\tã€sub_4D638ã€‘hookæ¡†æ¶æ£€æµ‹ å¤ªå¤šäº†å°±æ¢å¤ä¸¤ä¸ªçœ‹çœ‹\nisExportFunctionExistæ˜¯å¯¹ç›®æ ‡soä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼\né€šè¿‡mmapè¿›è¡Œæ˜ å°„åˆ°mapsä¸­ï¼Œä¸åŸæ¥å·²ç»åœ¨mapsçš„soåœ¨å†…å­˜ä¸­çš„å¯¼å‡ºå‡½æ•°è¿›è¡Œæ¯”å¯¹å‰16ä¸ªå­—èŠ‚ï¼Œ\nå¦‚æœæ¯”å¯¹ä¸ä¸€è‡´åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œå¦‚æœmapsæ²¡æœ‰è¿™ä¸ªsoåˆ™è¿”å›0ï¼Œå¦‚æœmapsä¸­æœ‰è¿™ä¸ªsoä½†æ²¡æœ‰è¿™ä¸ªè¦æœç´¢çš„å¯¼å‡ºå‡½æ•°åˆ™è¿”å›-1ã€‚\né€šè¿‡å¯¹æ¯”libart.soä¸­å¯¼å‡ºå‡½æ•°çš„å‰16å­—èŠ‚åˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹ã€‚\næ£€æŸ¥ç¯å¢ƒå˜é‡ CLASSPATH æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦éç©ºã€ä¸”æ˜¯å¦é•¿åº¦å¤§äºç­‰äº 6ã€‚ä¸ºäº†åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯å¦è¢«æ³¨å…¥ã€æ˜¯å¦æ­£ç¡®è®¾ç½®ã€æ˜¯å¦ä¼ªè£…æˆåŠŸç­‰ã€‚\nã€sub_4E308ã€‘è™šæ‹Ÿæœºæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 åœ¨Androidå¼€å‘ä¸­ï¼Œå¯ä»¥é€šè¿‡cæ¥å£ç›´æ¥è·å–è®¾å¤‡å±æ€§ï¼Œç³»ç»Ÿæ¥å£ä¸ºï¼š int __system_property_get(const char* name, char* value)ï¼› j___system_property_get_ptr(\u0026#34;ro.bluetooth.name\u0026#34;, a1) j___system_property_get_ptr(\u0026#34;vmos.browser.home\u0026#34;, a1) j___system_property_get_ptr(\u0026#34;vmprop.wifissid\u0026#34;, a1) j___system_property_get_ptr(\u0026#34;ro.product.manufacturer\u0026#34;, a1) j___system_property_get_ptr(\u0026#34;ro.product.model\u0026#34;, a1) j___system_property_get_ptr(\u0026#34;ro.product.manufacturer\u0026#34;, a1) ueventd.ttVM_x86.rcã€init.ttVM_x86.rcè¿™äº›æ˜¯ BlueStacks è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ä¼šåœ¨çœŸå®è®¾å¤‡ä¸­å‡ºç°ã€‚\nåˆ¤æ–­è¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ï¼Œ\tå…³é”®å­—åˆ¤æ–­ç­‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 #å…¶ä»–åšå®¢çš„æ€»ç»“ è°ƒç”¨ _system_property_get(\u0026#34;ro.bluetooth.name\u0026#34;, resultAddr) ro.ip.name ro.product.manufacturer ro.product.model è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸\u0026#34;vmos\u0026#34;ï¼ˆ\u0026#34;vmos\u0026#34;ä»£è¡¨è™šæ‹Ÿæœºï¼‰æ¯”è¾ƒ è°ƒç”¨ _system_property_get(\u0026#34;vmos.browser.home\u0026#34;, resultAddr) vmos.camera.enable ro.vmos.simplest.rom persist.vmos.setting.show persist.vmos.tool.show è¿™ä¹ˆå››ä¸ªå±æ€§å¯¹åº”çš„æ•°å€¼ä¸0x30ä½œæ¯”è¾ƒï¼ˆæ»¡è¶³ä¸€å®šçš„æ¡ä»¶resultAddrä¼šè¢«è‡ªåŠ¨èµ‹å€¼ä¸º0x30ï¼‰æ¯”è¾ƒï¼Œæ­¤å¤„æ˜¯æ¯”è¾ƒä¸ç›¸åŒ è°ƒç”¨ _system_property_get(\u0026#34;vmprop.wifissid\u0026#34;, resultAddr) è°ƒç”¨ _system_property_get(\u0026#34;persist.vmos.root.enable\u0026#34;, resultAddr) è°ƒç”¨ _system_property_get(\u0026#34;persist.vmos.root.show\u0026#34;, resultAddr) persist.vmos.skills.show persist.vmos.xposed.enable persist.vmos.xposed.show ro.vmos.simplest.rom vmos.camera.enable ä¸Šè¿°è°ƒç”¨_system_property_getè·å–å±æ€§å€¼ä¹‹åï¼Œå¦‚æœ_system_property_getçš„è¿”å›å€¼æ˜¯å¦å¤§äº0 è°ƒç”¨ access è®¿é—® /system/priv-app/vmos-pro-intent æ˜¯å¦å­˜åœ¨ fopen æ‰“å¼€ //proc/version.osed.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\u0026#34;titan\u0026#34; fopen æ‰“å¼€ //property_contexts.show æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\u0026#34;titan\u0026#34; fopen æ‰“å¼€ //service_contexts æ–‡ä»¶ï¼Œè°ƒç”¨fgetsè·å–æ–‡ä»¶å†…å®¹ï¼Œæ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²\u0026#34;titan\u0026#34; ã€sub_56C10ã€‘è°ƒè¯•å™¨æ£€æµ‹ é€šè¿‡foepn æ‰“å¼€/proc/pid/statusæ–‡ä»¶\nè°ƒç”¨sleep(1)å¾ªç¯æ£€æŸ¥statusæ–‡ä»¶æ£€æµ‹â€œstateâ€æ ‡å¿—å’Œ\u0026quot;TracerPid:\u0026ldquo;æ ‡å¿—\nå¦‚æœè·å–çš„pidä¸ä¸º0ä¸”è·Ÿè°ƒç”¨getpidå‡½æ•°è·å–è‡ªèº«pidçš„ä¸ä¸€è‡´åˆ™è°ƒç”¨ä¸­æ–­ kill å…³é—­è°ƒè¯•è¿›ç¨‹\nã€è§£å¯†DEXã€‘ åŠ å¯†æ•°æ®å­˜æ”¾äºæœ€å¤§çš„dexä¸­ï¼Œæ ¹æ®dexdata0å®šä½\næ¯æ¬¡ç”³è¯·0x20000å¤§å°å¾ªç¯è§£å¯†\nsub_38E04\nä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šè¢«åŠ å¯†æ•°æ®çš„åœ°å€ã€å­˜æ”¾è§£å¯†åæ•°æ®çš„ä½ç½®ã€å‚ä¸è§£å¯†è¿ç®—çš„32å­—èŠ‚å¯†é’¥\n1 2 makeInMemoryDexElements çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š å°†å†…å­˜ä¸­çš„ DEX æ–‡ä»¶ï¼ˆæˆ– ZIP/APK ä¸­çš„ DEXï¼‰è½¬æ¢ä¸º DexPathList ä¸­çš„ Element æ•°ç»„ï¼Œä¾› ClassLoader ä½¿ç”¨ã€‚ æœ€åä½¿ç”¨dexfile::loaderåŠ è½½è§£å¯†åçš„dexæ–‡ä»¶\nå‚è€ƒæ–‡çŒ® https://bbs.kanxue.com/thread-191649.htm\nhttps://zhuanlan.zhihu.com/p/685239153\nhttps://x2d1.github.io/2025/04/09/bangbang_protect_1/#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%83%A8%E5%88%86\n","permalink":"https://SimpsonGet.github.io/zh/posts/tech/bangbnagjiagu/","summary":"åˆ†ææ¢†æ¢†åŠ å›ºä¸­çš„å¯¹è®¾å¤‡ç›¸å…³æ£€æµ‹","title":"æ¢†æ¢†åŠ å›ºå…è´¹å£³åˆ†æ"},{"content":"\rè”ç³»æ–¹å¼ Email: foreverstudy001.gmail.com GitHub: https://github.com/SimpsonGet ","permalink":"https://SimpsonGet.github.io/zh/about/","summary":"\u003cimg src=\"/images/avatar.jpg\" alt=\"æˆ‘çš„å¤´åƒ\" width=\"150\"\u003e\r\n\u003ch2 id=\"è”ç³»æ–¹å¼\"\u003eè”ç³»æ–¹å¼\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eEmail: foreverstudy001.gmail.com\u003c/li\u003e\n\u003cli\u003eGitHub: \u003ca href=\"https://github.com/SimpsonGet\"\u003ehttps://github.com/SimpsonGet\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- #### æŠ€æœ¯æ ˆ\r\n\r\n---\r\n\r\n## æˆ‘çš„å…´è¶£\r\n\r\n-- --\u003e","title":"å…³äº"}]